define(["exports","./defaultValue-bcb5baf7","./Math-588d98f6","./Cartesian2-10213add","./Rectangle-de996bfb","./Transforms-2b063051","./Matrix4-c981b715","./ComponentDatatype-ec1abf38","./GeometryAttribute-49fe2445","./GeometryAttributes-a8cf4ac9","./GeometryPipeline-635df242","./IndexDatatype-523f50d6","./arrayRemoveDuplicates-f05ed775","./ArcType-90391c26","./EllipsoidRhumbLine-b25fd372","./PolygonPipeline-bd17f470"],function(e,x,I,E,p,d,y,A,P,_,g,M,G,L,f,D){"use strict";function S(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(S.prototype,{length:{get:function(){return this._length}}}),S.prototype.enqueue=function(e){this._array.push(e),this._length++},S.prototype.dequeue=function(){if(0!==this._length){var e=this._array,t=this._offset,r=e[t];return e[t]=void 0,10<++t&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,r}},S.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},S.prototype.contains=function(e){return-1!==this._array.indexOf(e)},S.prototype.clear=function(){this._array.length=this._offset=this._length=0},S.prototype.sort=function(e){0<this._offset&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};var R={computeHierarchyPackedLength:function(e){for(var t=0,r=[e];0<r.length;){var i=r.pop();if(x.defined(i)){t+=2;var n=i.positions,a=i.holes;if(x.defined(n)&&(t+=n.length*E.Cartesian3.packedLength),x.defined(a))for(var o=a.length,s=0;s<o;++s)r.push(a[s])}}return t},packPolygonHierarchy:function(e,t,r){for(var i=[e];0<i.length;){var n=i.pop();if(x.defined(n)){var a=n.positions,o=n.holes;if(t[r++]=x.defined(a)?a.length:0,t[r++]=x.defined(o)?o.length:0,x.defined(a))for(var s=a.length,u=0;u<s;++u,r+=3)E.Cartesian3.pack(a[u],t,r);if(x.defined(o))for(var l=o.length,h=0;h<l;++h)i.push(o[h])}}return r},unpackPolygonHierarchy:function(e,t){for(var r=e[t++],i=e[t++],n=new Array(r),a=0<i?new Array(i):void 0,o=0;o<r;++o,t+=E.Cartesian3.packedLength)n[o]=E.Cartesian3.unpack(e,t);for(var s=0;s<i;++s)a[s]=R.unpackPolygonHierarchy(e,t),t=a[s].startingIndex,delete a[s].startingIndex;return{positions:n,holes:a,startingIndex:t}}},v=new E.Cartesian3;R.subdivideLineCount=function(e,t,r){r=E.Cartesian3.distance(e,t)/r,r=Math.max(0,Math.ceil(I.CesiumMath.log2(r)));return Math.pow(2,r)};var m=new E.Cartographic,C=new E.Cartographic,b=new E.Cartographic,T=new E.Cartesian3;R.subdivideRhumbLineCount=function(e,t,r,i){t=e.cartesianToCartographic(t,m),r=e.cartesianToCartographic(r,C),i=new f.EllipsoidRhumbLine(t,r,e).surfaceDistance/i,i=Math.max(0,Math.ceil(I.CesiumMath.log2(i)));return Math.pow(2,i)},R.subdivideLine=function(e,t,r,i){var n=R.subdivideLineCount(e,t,r),a=E.Cartesian3.distance(e,t),o=a/n;x.defined(i)||(i=[]);var s=i;s.length=3*n;for(var u,l,h,c=0,f=0;f<n;f++){var p=(p=e,u=t,l=f*o,h=a,E.Cartesian3.subtract(u,p,v),E.Cartesian3.multiplyByScalar(v,l/h,v),E.Cartesian3.add(p,v,v),[v.x,v.y,v.z]);s[c++]=p[0],s[c++]=p[1],s[c++]=p[2]}return s},R.subdivideRhumbLine=function(e,t,r,i,n){var t=e.cartesianToCartographic(t,m),r=e.cartesianToCartographic(r,C),a=new f.EllipsoidRhumbLine(t,r,e),i=a.surfaceDistance/i,i=Math.max(0,Math.ceil(I.CesiumMath.log2(i))),o=Math.pow(2,i),s=a.surfaceDistance/o;x.defined(n)||(n=[]);var u=n;u.length=3*o;for(var l=0,h=0;h<o;h++){var c=a.interpolateUsingSurfaceDistance(h*s,b),c=e.cartographicToCartesian(c,T);u[l++]=c.x,u[l++]=c.y,u[l++]=c.z}return u};var w=new E.Cartesian3,N=new E.Cartesian3,O=new E.Cartesian3,q=new E.Cartesian3;R.scaleToGeodeticHeightExtruded=function(e,t,r,i,n,a){i=x.defaultValue(i,p.Ellipsoid.WGS84);var o=w,s=N,u=O,l=q;if(x.defined(e)&&x.defined(e.attributes)&&x.defined(e.attributes.position))for(var h=e.attributes.position.values,c=h.length/2,f=0;f<c;f+=3)E.Cartesian3.fromArray(h,f,u),i.geodeticSurfaceNormal(u,o),l=i.scaleToGeodeticSurface(u,l),s=E.Cartesian3.multiplyByScalar(o,r,s),s=a?E.Cartesian3.add(l,s,s):E.Cartesian3.add(u,s,s),h[f+c]=s.x,h[f+1+c]=s.y,h[f+2+c]=s.z,n&&(l=E.Cartesian3.clone(u,l)),s=E.Cartesian3.multiplyByScalar(o,t,s),s=E.Cartesian3.add(l,s,s),h[f]=s.x,h[f+1]=s.y,h[f+2]=s.z;return e},R.polygonOutlinesFromHierarchy=function(e,t,r){var i,n,a=[],o=new S;for(o.enqueue(e);0!==o.length;){var s=o.dequeue(),u=s.positions;if(t)for(n=u.length,h=0;h<n;h++)r.scaleToGeodeticSurface(u[h],u[h]);if(!((u=G.arrayRemoveDuplicates(u,E.Cartesian3.equalsEpsilon,!0)).length<3)){for(var l=s.holes?s.holes.length:0,h=0;h<l;h++){var c=s.holes[h],f=c.positions;if(t)for(n=f.length,i=0;i<n;++i)r.scaleToGeodeticSurface(f[i],f[i]);if(!((f=G.arrayRemoveDuplicates(f,E.Cartesian3.equalsEpsilon,!0)).length<3)){a.push(f);var p=0;for(x.defined(c.holes)&&(p=c.holes.length),i=0;i<p;i++)o.enqueue(c.holes[i])}}a.push(u)}}return a},R.polygonsFromHierarchy=function(e,t,r,i){var n=[],a=[],o=new S;for(o.enqueue(e);0!==o.length;){var s,u=o.dequeue(),l=u.positions,h=u.holes;if(r){s=l.length;for(var c=[],f=0;f<s;f++)c[f]=i.scaleToGeodeticSurface(l[f]);l=c}if(!((l=G.arrayRemoveDuplicates(l,E.Cartesian3.equalsEpsilon,!0)).length<3)){var p=t(l);if(x.defined(p)){var d=[],y=D.PolygonPipeline.computeWindingOrder2D(p);y===D.WindingOrder.CLOCKWISE&&(p.reverse(),l=l.slice().reverse());var g=l.slice(),v=x.defined(h)?h.length:0,m=[];for(f=0;f<v;f++){var C=h[f],b=C.positions;if(r){s=b.length;for(var c=[],T=0;T<s;++T)c[T]=i.scaleToGeodeticSurface(b[T]);b=c}if(!((b=G.arrayRemoveDuplicates(b,E.Cartesian3.equalsEpsilon,!0)).length<3)){var w=t(b);if(x.defined(w)){D.PolygonPipeline.computeWindingOrder2D(w)===D.WindingOrder.CLOCKWISE&&(w.reverse(),b=b.slice().reverse()),m.push(b),d.push(g.length),g=g.concat(b),p=p.concat(w);var I=0;for(x.defined(C.holes)&&(I=C.holes.length),T=0;T<I;T++)o.enqueue(C.holes[T])}}}n.push({outerRing:l,holes:m}),a.push({positions:g,positions2D:p,holes:d})}}}return{hierarchy:n,polygons:a}};var B=new E.Cartesian2,H=new E.Cartesian3,k=new d.Quaternion,z=new y.Matrix3;R.computeBoundingRectangle=function(e,t,r,i,n){for(var i=d.Quaternion.fromAxisAngle(e,i,k),a=y.Matrix3.fromQuaternion(i,z),o=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,u=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,h=r.length,c=0;c<h;++c){var f=E.Cartesian3.clone(r[c],H);y.Matrix3.multiplyByVector(a,f,f);f=t(f,B);x.defined(f)&&(o=Math.min(o,f.x),s=Math.max(s,f.x),u=Math.min(u,f.y),l=Math.max(l,f.y))}return n.x=o,n.y=u,n.width=s-o,n.height=l-u,n},R.createGeometryFromPositions=function(e,t,r,i,n,a){var o=D.PolygonPipeline.triangulate(t.positions2D,t.holes);o.length<3&&(o=[0,1,2]);var s=t.positions;if(i){for(var u=s.length,l=new Array(3*u),h=0,c=0;c<u;c++){var f=s[c];l[h++]=f.x,l[h++]=f.y,l[h++]=f.z}i=new P.Geometry({attributes:{position:new P.GeometryAttribute({componentDatatype:A.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:l})},indices:o,primitiveType:P.PrimitiveType.TRIANGLES});return n.normal?g.GeometryPipeline.computeNormal(i):i}return a===L.ArcType.GEODESIC?D.PolygonPipeline.computeSubdivision(e,s,o,r):a===L.ArcType.RHUMB?D.PolygonPipeline.computeRhumbLineSubdivision(e,s,o,r):void 0};var W=[],F=new E.Cartesian3,V=new E.Cartesian3;R.computeWallGeometry=function(e,t,r,i,n){var a,o,s,u=e.length,l=0;if(i)for(o=3*u*2,a=new Array(2*o),s=0;s<u;s++)p=e[s],d=e[(s+1)%u],a[l]=a[l+o]=p.x,a[++l]=a[l+o]=p.y,a[++l]=a[l+o]=p.z,a[++l]=a[l+o]=d.x,a[++l]=a[l+o]=d.y,a[++l]=a[l+o]=d.z,++l;else{var h=I.CesiumMath.chordLength(r,t.maximumRadius),c=0;if(n===L.ArcType.GEODESIC)for(s=0;s<u;s++)c+=R.subdivideLineCount(e[s],e[(s+1)%u],h);else if(n===L.ArcType.RHUMB)for(s=0;s<u;s++)c+=R.subdivideRhumbLineCount(t,e[s],e[(s+1)%u],h);for(o=3*(c+u),a=new Array(2*o),s=0;s<u;s++){var f,p=e[s],d=e[(s+1)%u];n===L.ArcType.GEODESIC?f=R.subdivideLine(p,d,h,W):n===L.ArcType.RHUMB&&(f=R.subdivideRhumbLine(t,p,d,h,W));for(var y=f.length,g=0;g<y;++g,++l)a[l]=f[g],a[l+o]=f[g];a[l]=d.x,a[l+o]=d.x,a[++l]=d.y,a[l+o]=d.y,a[++l]=d.z,a[l+o]=d.z,++l}}u=a.length;var v=M.IndexDatatype.createTypedArray(u/3,u-6*e.length),m=0;for(u/=6,s=0;s<u;s++){var C=s,b=C+1,T=C+u,w=T+1;p=E.Cartesian3.fromArray(a,3*C,F),d=E.Cartesian3.fromArray(a,3*b,V),E.Cartesian3.equalsEpsilon(p,d,I.CesiumMath.EPSILON10,I.CesiumMath.EPSILON10)||(v[m++]=C,v[m++]=T,v[m++]=b,v[m++]=b,v[m++]=T,v[m++]=w)}return new P.Geometry({attributes:new _.GeometryAttributes({position:new P.GeometryAttribute({componentDatatype:A.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:a})}),indices:v,primitiveType:P.PrimitiveType.TRIANGLES})},e.PolygonGeometryLibrary=R});
