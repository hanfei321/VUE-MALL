define(["./defaultValue-bcb5baf7","./DeveloperError-b273b01a","./Check-f9a1a1be","./Math-588d98f6","./Cartesian2-10213add","./Rectangle-de996bfb","./Transforms-2b063051","./Matrix4-c981b715","./RuntimeError-1b5fbc4d","./WebGLConstants-667a4a5e","./when-ae2a7552","./buildModuleUrl-cd6b3599","./AttributeCompression-8a5fa32d","./IndexDatatype-523f50d6","./IntersectionTests-cc1722b0","./Plane-bb97f210","./createTaskProcessorWorker","./EllipsoidTangentPlane-86347fa6","./OrientedBoundingBox-6de788ea","./Color-7f022f58"],function(ye,e,a,Ie,me,we,r,n,t,i,o,s,ve,xe,f,d,c,u,Ae,Ee){"use strict";var Ne=new me.Cartesian3,Te=new we.Ellipsoid,ke=new we.Rectangle,Be={min:void 0,max:void 0,indexBytesPerElement:void 0};function Le(e,a,r){var n=a.length,t=2+n*Ae.OrientedBoundingBox.packedLength+1+function(e){for(var a=e.length,r=0,n=0;n<a;++n)r+=Ee.Color.packedLength+3+e[n].batchIds.length;return r}(r),i=new Float64Array(t),o=0;i[o++]=e,i[o++]=n;for(var s=0;s<n;++s)Ae.OrientedBoundingBox.pack(a[s],i,o),o+=Ae.OrientedBoundingBox.packedLength;var f=r.length;i[o++]=f;for(var d=0;d<f;++d){var c=r[d];Ee.Color.pack(c.color,i,o),o+=Ee.Color.packedLength,i[o++]=c.offset,i[o++]=c.count;var u=c.batchIds,l=u.length;i[o++]=l;for(var h=0;h<l;++h)i[o++]=u[h]}return i}var Oe=new me.Cartesian3,Ue=new me.Cartesian3,Pe=new me.Cartesian3,Fe=new me.Cartesian3,Me=new me.Cartesian3,Re=new me.Cartographic,Se=new we.Rectangle;return c(function(e,a){var r;i=e.packedBuffer,r=new Float64Array(i),i=0,Be.indexBytesPerElement=r[i++],Be.min=r[i++],Be.max=r[i++],me.Cartesian3.unpack(r,3,Ne),i+=me.Cartesian3.packedLength,we.Ellipsoid.unpack(r,i,Te),i+=we.Ellipsoid.packedLength,we.Rectangle.unpack(r,i,ke);var n,t=new(2===Be.indexBytesPerElement?Uint16Array:Uint32Array)(e.indices),i=new Uint16Array(e.positions),o=new Uint32Array(e.counts),s=new Uint32Array(e.indexCounts),f=new Uint32Array(e.batchIds),d=new Uint32Array(e.batchTableColors),c=new Array(o.length),u=Ne,l=Te,h=ke,b=Be.min,g=Be.max,p=e.minimumHeights,C=e.maximumHeights;ye.defined(p)&&ye.defined(C)&&(p=new Float32Array(p),C=new Float32Array(C));var y=i.length/2,I=i.subarray(0,y),m=i.subarray(y,2*y);ve.AttributeCompression.zigZagDeltaDecode(I,m);for(var w=new Float64Array(3*y),v=0;v<y;++v){var x=I[v],A=m[v],x=Ie.CesiumMath.lerp(h.west,h.east,x/32767),A=Ie.CesiumMath.lerp(h.south,h.north,A/32767),A=me.Cartographic.fromRadians(x,A,0,Re),A=l.cartographicToCartesian(A,Oe);me.Cartesian3.pack(A,w,3*v)}var E=o.length,N=new Array(E),T=new Array(E),k=0,B=0;for(v=0;v<E;++v)N[v]=k,T[v]=B,k+=o[v],B+=s[v];var L,O=new Float32Array(3*y*2),U=new Uint16Array(2*y),P=new Uint32Array(T.length),F=new Uint32Array(s.length),M=[],R={};for(v=0;v<E;++v)n=d[v],ye.defined(R[n])?(R[n].positionLength+=o[v],R[n].indexLength+=s[v],R[n].batchIds.push(v)):R[n]={positionLength:o[v],indexLength:s[v],offset:0,indexOffset:0,batchIds:[v]};var S,D=0,_=0;for(n in R)R.hasOwnProperty(n)&&((L=R[n]).offset=D,L.indexOffset=_,D+=2*L.positionLength,_+=S=2*L.indexLength+6*L.positionLength,L.indexLength=S);var G=[];for(n in R)R.hasOwnProperty(n)&&(L=R[n],G.push({color:Ee.Color.fromRgba(parseInt(n)),offset:L.indexOffset,count:L.indexLength,batchIds:L.batchIds}));for(v=0;v<E;++v){var V=(L=R[n=d[v]]).offset,Y=3*V,H=V,W=N[v],z=o[v],Z=f[v],j=b,q=g;ye.defined(p)&&ye.defined(C)&&(j=p[v],q=C[v]);for(var J=Number.POSITIVE_INFINITY,K=Number.NEGATIVE_INFINITY,Q=Number.POSITIVE_INFINITY,X=Number.NEGATIVE_INFINITY,$=0;$<z;++$){var ee=me.Cartesian3.unpack(w,3*W+3*$,Oe);l.scaleToGeodeticSurface(ee,ee);var ae=l.cartesianToCartographic(ee,Re),re=ae.latitude,ne=ae.longitude,J=Math.min(re,J),K=Math.max(re,K),Q=Math.min(ne,Q),X=Math.max(ne,X),ae=l.geodeticSurfaceNormal(ee,Ue),re=me.Cartesian3.multiplyByScalar(ae,j,Pe),ne=me.Cartesian3.add(ee,re,Fe),re=me.Cartesian3.multiplyByScalar(ae,q,re),re=me.Cartesian3.add(ee,re,Me);me.Cartesian3.subtract(re,u,re),me.Cartesian3.subtract(ne,u,ne),me.Cartesian3.pack(re,O,Y),me.Cartesian3.pack(ne,O,Y+3),U[H]=Z,U[H+1]=Z,Y+=6,H+=2}(h=Se).west=Q,h.east=X,h.south=J,h.north=K,c[v]=Ae.OrientedBoundingBox.fromRectangle(h,b,g,l);var te=L.indexOffset,ie=T[v],oe=s[v];for(P[v]=te,$=0;$<oe;$+=3){var se=t[ie+$]-W,fe=t[ie+$+1]-W,de=t[ie+$+2]-W;M[te++]=2*se+V,M[te++]=2*fe+V,M[te++]=2*de+V,M[te++]=2*de+1+V,M[te++]=2*fe+1+V,M[te++]=2*se+1+V}for($=0;$<z;++$){var ce=$,ue=($+1)%z;M[te++]=2*ce+1+V,M[te++]=2*ue+V,M[te++]=2*ce+V,M[te++]=2*ce+1+V,M[te++]=2*ue+1+V,M[te++]=2*ue+V}L.offset+=2*z,L.indexOffset=te,F[v]=te-P[v]}M=xe.IndexDatatype.createTypedArray(O.length/3,M);for(var le=G.length,he=0;he<le;++he){for(var be=G[he].batchIds,ge=0,pe=be.length,Ce=0;Ce<pe;++Ce)ge+=F[be[Ce]];G[he].count=ge}return i=Le(2===M.BYTES_PER_ELEMENT?xe.IndexDatatype.UNSIGNED_SHORT:xe.IndexDatatype.UNSIGNED_INT,c,G),a.push(O.buffer,M.buffer,P.buffer,F.buffer,U.buffer,i.buffer),{positions:O.buffer,indices:M.buffer,indexOffsets:P.buffer,indexCounts:F.buffer,batchIds:U.buffer,packedBuffer:i.buffer}})});
