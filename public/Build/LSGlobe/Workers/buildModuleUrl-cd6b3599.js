define(["exports","./defaultValue-bcb5baf7","./DeveloperError-b273b01a","./Check-f9a1a1be","./RuntimeError-1b5fbc4d","./when-ae2a7552"],function(e,g,t,r,q,h){"use strict";function i(e){e instanceof i?(this.scheme=e.scheme,this.authority=e.authority,this.path=e.path,this.query=e.query,this.fragment=e.fragment):e&&(e=n.exec(e),this.scheme=e[1],this.authority=e[2],this.path=e[3],this.query=e[4],this.fragment=e[5])}i.prototype.scheme=null,i.prototype.authority=null,i.prototype.path="",i.prototype.query=null,i.prototype.fragment=null;var n=new RegExp("^(?:([^:/?#]+):)?(?://([^/?#]*))?([^?#]*)(?:\\?([^#]*))?(?:#(.*))?$");i.prototype.getScheme=function(){return this.scheme},i.prototype.getAuthority=function(){return this.authority},i.prototype.getPath=function(){return this.path},i.prototype.getQuery=function(){return this.query},i.prototype.getFragment=function(){return this.fragment},i.prototype.isAbsolute=function(){return!!this.scheme&&!this.fragment},i.prototype.isSameDocumentAs=function(e){return e.scheme==this.scheme&&e.authority==this.authority&&e.path==this.path&&e.query==this.query},i.prototype.equals=function(e){return this.isSameDocumentAs(e)&&e.fragment==this.fragment},i.prototype.normalize=function(){this.removeDotSegments(),this.scheme&&(this.scheme=this.scheme.toLowerCase()),this.authority&&(this.authority=this.authority.replace(u,f).replace(o,a)),this.path&&(this.path=this.path.replace(o,a)),this.query&&(this.query=this.query.replace(o,a)),this.fragment&&(this.fragment=this.fragment.replace(o,a))};var o=/%[0-9a-z]{2}/gi,s=/[a-zA-Z0-9\-\._~]/,u=/(.*@)?([^@:]*)(:.*)?/;function a(e){var t=unescape(e);return s.test(t)?t:e.toUpperCase()}function f(e,t,r,n){return(t||"")+r.toLowerCase()+(n||"")}function c(e,t){if(null===e||"object"!=typeof e)return e;t=g.defaultValue(t,!1);var r,n,i=new e.constructor;for(r in e)e.hasOwnProperty(r)&&(n=e[r],t&&(n=c(n,t)),i[r]=n);return i}function p(e,t,r){r=g.defaultValue(r,!1);var n,i,o,s={},u=g.defined(e),a=g.defined(t);if(u)for(n in e)e.hasOwnProperty(n)&&(i=e[n],a&&r&&"object"==typeof i&&t.hasOwnProperty(n)?(o=t[n],s[n]="object"==typeof o?p(i,o,r):i):s[n]=i);if(a)for(n in t)t.hasOwnProperty(n)&&!s.hasOwnProperty(n)&&(o=t[n],s[n]=o);return s}function l(e,t){var r;return"undefined"!=typeof document&&(r=document),l._implementation(e,t,r)}i.prototype.resolve=function(e){var t=new i;return this.scheme?(t.scheme=this.scheme,t.authority=this.authority,t.path=this.path,t.query=this.query):(t.scheme=e.scheme,this.authority?(t.authority=this.authority,t.path=this.path,t.query=this.query):(t.authority=e.authority,""==this.path?(t.path=e.path,t.query=this.query||e.query):("/"==this.path.charAt(0)?t.path=this.path:e.authority&&""==e.path?t.path="/"+this.path:t.path=e.path.substring(0,e.path.lastIndexOf("/")+1)+this.path,t.removeDotSegments(),t.query=this.query))),t.fragment=this.fragment,t},i.prototype.removeDotSegments=function(){var e,t=this.path.split("/"),r=[],n=""==t[0];n&&t.shift();for(""==t[0]&&t.shift();t.length;)".."==(e=t.shift())?r.pop():"."!=e&&r.push(e);"."!=e&&".."!=e||r.push(""),n&&r.unshift(""),this.path=r.join("/")},i.prototype.toString=function(){var e="";return this.scheme&&(e+=this.scheme+":"),this.authority&&(e+="//"+this.authority),e+=this.path,this.query&&(e+="?"+this.query),this.fragment&&(e+="#"+this.fragment),e},l._implementation=function(e,t,r){if(!g.defined(t)){if(void 0===r)return e;t=g.defaultValue(r.baseURI,r.location.href)}t=new i(t);return new i(e).resolve(t).toString()};var d,m=/^blob:/i;function y(e){return m.test(e)}var v=/^data:/i;function b(e){return v.test(e)}var w=Object.freeze({UNISSUED:0,ISSUED:1,ACTIVE:2,RECEIVED:3,CANCELLED:4,FAILED:5}),A=Object.freeze({TERRAIN:0,IMAGERY:1,TILES3D:2,OTHER:3});function _(e){e=g.defaultValue(e,g.defaultValue.EMPTY_OBJECT);var t=g.defaultValue(e.throttleByServer,!1),r=g.defaultValue(e.throttle,!1);this.url=e.url,this.requestFunction=e.requestFunction,this.cancelFunction=e.cancelFunction,this.priorityFunction=e.priorityFunction,this.priority=g.defaultValue(e.priority,0),this.throttle=r,this.throttleByServer=t,this.type=g.defaultValue(e.type,A.OTHER),this.serverKey=void 0,this.state=w.UNISSUED,this.deferred=void 0,this.cancelled=!1}function R(e,t,r){this.statusCode=e,this.response=t,this.responseHeaders=r,"string"==typeof this.responseHeaders&&(this.responseHeaders=function(e){var t={};if(!e)return t;for(var r=e.split("\r\n"),n=0;n<r.length;++n){var i,o=r[n],s=o.indexOf(": ");0<s&&(i=o.substring(0,s),s=o.substring(s+2),t[i]=s)}return t}(this.responseHeaders))}function E(){this._listeners=[],this._scopes=[],this._toRemove=[],this._insideRaiseEvent=!1}function O(e,t){return t-e}function C(e){this._comparator=e.comparator,this._array=[],this._length=0,this._maximumLength=void 0}function S(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}_.prototype.cancel=function(){this.cancelled=!0},_.prototype.clone=function(e){return g.defined(e)?(e.url=this.url,e.requestFunction=this.requestFunction,e.cancelFunction=this.cancelFunction,e.priorityFunction=this.priorityFunction,e.priority=this.priority,e.throttle=this.throttle,e.throttleByServer=this.throttleByServer,e.type=this.type,e.serverKey=this.serverKey,e.state=this.RequestState.UNISSUED,e.deferred=void 0,e.cancelled=!1,e):new _(this)},R.prototype.toString=function(){var e="Request has failed.";return g.defined(this.statusCode)&&(e+=" Status Code: "+this.statusCode),e},Object.defineProperties(E.prototype,{numberOfListeners:{get:function(){return this._listeners.length-this._toRemove.length}}}),E.prototype.addEventListener=function(e,t){this._listeners.push(e),this._scopes.push(t);var r=this;return function(){r.removeEventListener(e,t)}},E.prototype.removeEventListener=function(e,t){for(var r=this._listeners,n=this._scopes,i=-1,o=0;o<r.length;o++)if(r[o]===e&&n[o]===t){i=o;break}return-1!==i&&(this._insideRaiseEvent?(this._toRemove.push(i),r[i]=void 0,n[i]=void 0):(r.splice(i,1),n.splice(i,1)),!0)},E.prototype.raiseEvent=function(){this._insideRaiseEvent=!0;for(var e=this._listeners,t=this._scopes,r=e.length,n=0;n<r;n++){var i=e[n];g.defined(i)&&e[n].apply(t[n],arguments)}var o=this._toRemove;if(0<(r=o.length)){for(o.sort(O),n=0;n<r;n++){var s=o[n];e.splice(s,1),t.splice(s,1)}o.length=0}this._insideRaiseEvent=!1},Object.defineProperties(C.prototype,{length:{get:function(){return this._length}},internalArray:{get:function(){return this._array}},maximumLength:{get:function(){return this._maximumLength},set:function(e){var t=this._length;if(e<t){for(var r=this._array,n=e;n<t;++n)r[n]=void 0;this._length=e,r.length=e}this._maximumLength=e}},comparator:{get:function(){return this._comparator}}}),C.prototype.reserve=function(e){e=g.defaultValue(e,this._length),this._array.length=e},C.prototype.heapify=function(e){e=g.defaultValue(e,0);for(var t=this._length,r=this._comparator,n=this._array,i=-1,o=!0;o;){var s=2*(e+1),u=s-1,i=u<t&&r(n[u],n[e])<0?u:e;s<t&&r(n[s],n[i])<0&&(i=s),i!==e?(S(n,i,e),e=i):o=!1}},C.prototype.resort=function(){for(var e=this._length,t=Math.ceil(e/2);0<=t;--t)this.heapify(t)},C.prototype.insert=function(e){var t,r=this._array,n=this._comparator,i=this._maximumLength,o=this._length++;for(o<r.length?r[o]=e:r.push(e);0!==o;){var s=Math.floor((o-1)/2);if(!(n(r[o],r[s])<0))break;S(r,o,s),o=s}return g.defined(i)&&this._length>i&&(t=r[i],this._length=i),t},C.prototype.pop=function(e){if(e=g.defaultValue(e,0),0!==this._length){var t=this._array,r=t[e];return S(t,e,--this._length),this.heapify(e),t[this._length]=void 0,r}};var I={numberOfAttemptedRequests:0,numberOfActiveRequests:0,numberOfCancelledRequests:0,numberOfCancelledActiveRequests:0,numberOfFailedRequests:0,numberOfActiveRequestsEver:0,lastNumberOfActiveRequests:0},T=20,U=new C({comparator:function(e,t){return e.priority-t.priority}});U.maximumLength=T,U.reserve(T);var B=[],x={},L="undefined"!=typeof document?new i(document.location.href):new i,V=new E;function P(){}function D(e){g.defined(e.priorityFunction)&&(e.priority=e.priorityFunction())}function F(e){var t=g.defaultValue(P.requestsByServer[e],P.maximumRequestsPerServer);return x[e]<t}function j(e){return e.state===w.UNISSUED&&(e.state=w.ISSUED,e.deferred=h.when.defer()),e.deferred.promise}function M(e){var t,r,n=j(e);return e.state=w.ACTIVE,B.push(e),++I.numberOfActiveRequests,++I.numberOfActiveRequestsEver,++x[e.serverKey],e.requestFunction().then((r=e,function(e){var t;r.state!==w.CANCELLED&&(t=r.deferred,--I.numberOfActiveRequests,--x[r.serverKey],V.raiseEvent(),r.state=w.RECEIVED,r.deferred=void 0,t.resolve(e))})).otherwise((t=e,function(e){t.state!==w.CANCELLED&&(++I.numberOfFailedRequests,--I.numberOfActiveRequests,--x[t.serverKey],V.raiseEvent(e),t.state=w.FAILED,t.deferred.reject(e))})),n}function N(e){var t,r=e.state===w.ACTIVE;e.state=w.CANCELLED,++I.numberOfCancelledRequests,g.defined(e.deferred)&&(t=e.deferred,e.deferred=void 0,t.reject()),r&&(--I.numberOfActiveRequests,--x[e.serverKey],++I.numberOfCancelledActiveRequests),g.defined(e.cancelFunction)&&e.cancelFunction()}P.maximumRequests=50,P.maximumRequestsPerServer=6,P.requestsByServer={"api.cesium.com:443":18,"assets.cesium.com:443":18},P.throttleRequests=!0,P.debugShowStatistics=!1,P.requestCompletedEvent=V,Object.defineProperties(P,{statistics:{get:function(){return I}},priorityHeapLength:{get:function(){return T},set:function(e){if(e<T)for(;U.length>e;)N(U.pop());T=e,U.maximumLength=e,U.reserve(e)}}}),P.update=function(){for(var e,t=0,r=B.length,n=0;n<r;++n)(e=B[n]).cancelled&&N(e),e.state===w.ACTIVE?0<t&&(B[n-t]=e):++t;B.length-=t;var i=U.internalArray,o=U.length;for(n=0;n<o;++n)D(i[n]);U.resort();for(var s=Math.max(P.maximumRequests-B.length,0),u=0;u<s&&0<U.length;)!(e=U.pop()).cancelled&&(!e.throttleByServer||F(e.serverKey))?(M(e),++u):N(e);P.debugShowStatistics&&(0===I.numberOfActiveRequests&&0<I.lastNumberOfActiveRequests&&(0<I.numberOfAttemptedRequests&&(console.log("Number of attempted requests: "+I.numberOfAttemptedRequests),I.numberOfAttemptedRequests=0),0<I.numberOfCancelledRequests&&(console.log("Number of cancelled requests: "+I.numberOfCancelledRequests),I.numberOfCancelledRequests=0),0<I.numberOfCancelledActiveRequests&&(console.log("Number of cancelled active requests: "+I.numberOfCancelledActiveRequests),I.numberOfCancelledActiveRequests=0),0<I.numberOfFailedRequests&&(console.log("Number of failed requests: "+I.numberOfFailedRequests),I.numberOfFailedRequests=0)),I.lastNumberOfActiveRequests=I.numberOfActiveRequests)},P.getServerKey=function(e){var t=new i(e).resolve(L);t.normalize();e=t.authority;/:/.test(e)||(e=e+":"+("https"===t.scheme?"443":"80"));t=x[e];return g.defined(t)||(x[e]=0),e},P.request=function(e){if(b(e.url)||y(e.url))return V.raiseEvent(),e.state=w.RECEIVED,e.requestFunction();if(++I.numberOfAttemptedRequests,g.defined(e.serverKey)||(e.serverKey=P.getServerKey(e.url)),!P.throttleRequests||!e.throttleByServer||F(e.serverKey)){if(!P.throttleRequests||!e.throttle)return M(e);if(!(B.length>=P.maximumRequests)){D(e);var t=U.insert(e);if(g.defined(t)){if(t===e)return;N(t)}return j(e)}}},P.clearForSpecs=function(){for(;0<U.length;)N(U.pop());for(var e=B.length,t=0;t<e;++t)N(B[t]);B.length=0,x={},I.numberOfAttemptedRequests=0,I.numberOfActiveRequests=0,I.numberOfCancelledRequests=0,I.numberOfCancelledActiveRequests=0,I.numberOfFailedRequests=0,I.numberOfActiveRequestsEver=0,I.lastNumberOfActiveRequests=0},P.numberOfActiveRequestsByServer=function(e){return x[e]},P.requestHeap=U;var k={},H={};k.add=function(e,t){t=e.toLowerCase()+":"+t;g.defined(H[t])||(H[t]=!0)},k.remove=function(e,t){t=e.toLowerCase()+":"+t;g.defined(H[t])&&delete H[t]},k.contains=function(e){e=function(e){var t=new i(e);if(t.normalize(),e=t.getAuthority(),g.defined(e)){if(-1!==e.indexOf("@")&&(e=e.split("@")[1]),-1===e.indexOf(":")){t=t.getScheme();if(g.defined(t)||(t=(t=window.location.protocol).substring(0,t.length-1)),"http"===t)e+=":80";else{if("https"!==t)return;e+=":443"}}return e}}(e);return!(!g.defined(e)||!g.defined(H[e]))},k.clear=function(){H={}};var Y,J=function(){try{var e=new XMLHttpRequest;return e.open("GET","#",!0),(e.responseType="blob")===e.responseType}catch(e){return!1}}();function X(e,t,r,n){var i,o=e.query;if(!g.defined(o)||0===o.length)return 1;o=-1===o.indexOf("=")?((i={})[o]=void 0,i):function(e){var t={};if(""===e)return t;for(var r=e.replace(/\+/g,"%20").split(/[&;]/),n=0,i=r.length;n<i;++n){var o=r[n].split("="),s=decodeURIComponent(o[0]),u=o[1],u=g.defined(u)?decodeURIComponent(u):"",o=t[s];"string"==typeof o?t[s]=[o,u]:Array.isArray(o)?o.push(u):t[s]=u}return t}(o),t._queryParameters=r?G(o,t._queryParameters,n):o,e.query=void 0}function K(e,t){var r=t._queryParameters,t=Object.keys(r);1!==t.length||g.defined(r[t[0]])?e.query=function(e){var t,r="";for(t in e)if(e.hasOwnProperty(t)){var n=e[t],i=encodeURIComponent(t)+"=";if(Array.isArray(n))for(var o=0,s=n.length;o<s;++o)r+=i+encodeURIComponent(n[o])+"&";else r+=i+encodeURIComponent(n)+"&"}return r=r.slice(0,-1)}(r):e.query=t[0]}function z(e,t){return g.defined(e)?g.defined(e.clone)?e.clone():c(e):t}function Q(e){if(e.state===w.ISSUED||e.state===w.ACTIVE)throw new q.RuntimeError("The Resource is already being fetched.");e.state=w.UNISSUED,e.deferred=void 0}function G(e,t,r){if(!r)return p(e,t);var n,i,o,s=c(e,!0);for(n in t)t.hasOwnProperty(n)&&(i=s[n],o=t[n],g.defined(i)?(Array.isArray(i)||(i=s[n]=[i]),s[n]=i.concat(o)):s[n]=Array.isArray(o)?o.slice():o);return s}function W(e){"string"==typeof(e=g.defaultValue(e,g.defaultValue.EMPTY_OBJECT))&&(e={url:e}),this._url=void 0,this._templateValues=z(e.templateValues,{}),this._queryParameters=z(e.queryParameters,{}),this.headers=z(e.headers,{}),this.request=g.defaultValue(e.request,new _),this.proxy=e.proxy,this.retryCallback=e.retryCallback,this.retryAttempts=g.defaultValue(e.retryAttempts,0),this._retryCount=0;e=new i(e.url);X(e,this,!0,!0),e.fragment=void 0,this._url=e.toString()}function $(e){var r=e.resource,n=e.flipY,i=e.preferImageBitmap,o=r.request;o.url=r.url,o.requestFunction=function(){var e=!1;r.isDataUri||r.isBlobUri||(e=r.isCrossOriginUrl);var t=h.when.defer();return W._Implementations.createImage(o,e,t,n,i),t.promise};e=P.request(o);if(g.defined(e))return e.otherwise(function(t){return o.state!==w.FAILED?h.when.reject(t):r.retryOnError(t).then(function(e){return e?(o.state=w.UNISSUED,o.deferred=void 0,$({resource:r,flipY:n,preferImageBitmap:i})):h.when.reject(t)})})}W.createIfNeeded=function(e){return e instanceof W?e.getDerivedResource({request:e.request}):"string"!=typeof e?e:new W({url:e})},W.supportsImageBitmapOptions=function(){if(g.defined(Y))return Y;if("function"!=typeof createImageBitmap)return Y=h.when.resolve(!1);return Y=W.fetchBlob({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWP4////fwAJ+wP9CNHoHgAAAABJRU5ErkJggg=="}).then(function(e){return createImageBitmap(e,{imageOrientation:"flipY",premultiplyAlpha:"none"})}).then(function(e){return!0}).otherwise(function(){return!1})},Object.defineProperties(W,{isBlobSupported:{get:function(){return J}}}),Object.defineProperties(W.prototype,{queryParameters:{get:function(){return this._queryParameters}},templateValues:{get:function(){return this._templateValues}},url:{get:function(){return this.getUrlComponent(!0,!0)},set:function(e){e=new i(e);X(e,this,!1),e.fragment=void 0,this._url=e.toString()}},extension:{get:function(){return e=this._url,(t=new i(e)).normalize(),e=t.path,-1!==(t=e.lastIndexOf("/"))&&(e=e.substr(t+1)),e=-1===(t=e.lastIndexOf("."))?"":e.substr(t+1);var e,t}},isDataUri:{get:function(){return b(this._url)}},isBlobUri:{get:function(){return y(this._url)}},isCrossOriginUrl:{get:function(){return function(e){g.defined(d)||(d=document.createElement("a")),d.href=window.location.href;var t=d.host,r=d.protocol;return d.href=e,d.href=d.href,r!==d.protocol||t!==d.host}(this._url)}},hasHeaders:{get:function(){return 0<Object.keys(this.headers).length}}}),W.prototype.toString=function(){return this.getUrlComponent(!0,!0)},W.prototype.getUrlComponent=function(e,t){if(this.isDataUri)return this._url;var r=new i(this._url);e&&K(r,this);var r=r.toString().replace(/%7B/g,"{").replace(/%7D/g,"}"),n=this._templateValues,r=r.replace(/{(.*?)}/g,function(e,t){t=n[t];return g.defined(t)?encodeURIComponent(t):e});return t&&g.defined(this.proxy)&&(r=this.proxy.getURL(r)),r},W.prototype.setQueryParameters=function(e,t){this._queryParameters=t?G(this._queryParameters,e,!1):G(e,this._queryParameters,!1)},W.prototype.appendQueryParameters=function(e){this._queryParameters=G(e,this._queryParameters,!0)},W.prototype.setTemplateValues=function(e,t){this._templateValues=t?p(this._templateValues,e):p(e,this._templateValues)},W.prototype.getDerivedResource=function(e){var t,r=this.clone();return r._retryCount=0,g.defined(e.url)&&(X(t=new i(e.url),r,!0,g.defaultValue(e.preserveQueryParameters,!1)),t.fragment=void 0,r._url=t.resolve(new i(l(this._url))).toString()),g.defined(e.queryParameters)&&(r._queryParameters=p(e.queryParameters,r._queryParameters)),g.defined(e.templateValues)&&(r._templateValues=p(e.templateValues,r.templateValues)),g.defined(e.headers)&&(r.headers=p(e.headers,r.headers)),g.defined(e.proxy)&&(r.proxy=e.proxy),g.defined(e.request)&&(r.request=e.request),g.defined(e.retryCallback)&&(r.retryCallback=e.retryCallback),g.defined(e.retryAttempts)&&(r.retryAttempts=e.retryAttempts),r},W.prototype.retryOnError=function(e){var t=this.retryCallback;if("function"!=typeof t||this._retryCount>=this.retryAttempts)return h.when(!1);var r=this;return h.when(t(this,e)).then(function(e){return++r._retryCount,e})},W.prototype.clone=function(e){return g.defined(e)||(e=new W({url:this._url})),e._url=this._url,e._queryParameters=c(this._queryParameters),e._templateValues=c(this._templateValues),e.headers=c(this.headers),e.proxy=this.proxy,e.retryCallback=this.retryCallback,e.retryAttempts=this.retryAttempts,e._retryCount=0,e.request=this.request.clone(),e},W.prototype.getBaseUri=function(e){return t=this.getUrlComponent(e),r=e,n="",-1!==(e=t.lastIndexOf("/"))&&(n=t.substring(0,e+1)),r&&(t=new i(t),g.defined(t.query)&&(n+="?"+t.query),g.defined(t.fragment)&&(n+="#"+t.fragment)),n;var t,r,n},W.prototype.appendForwardSlash=function(){var e;this._url=(0!==(e=this._url).length&&"/"===e[e.length-1]||(e+="/"),e)},W.prototype.fetchArrayBuffer=function(){return this.fetch({responseType:"arraybuffer"})},W.fetchArrayBuffer=function(e){return new W(e).fetchArrayBuffer()},W.prototype.fetchBlob=function(){return this.fetch({responseType:"blob"})},W.fetchBlob=function(e){return new W(e).fetchBlob()},W.prototype.fetchImage=function(e){e=g.defaultValue(e,g.defaultValue.EMPTY_OBJECT);var t=g.defaultValue(e.preferImageBitmap,!1),r=g.defaultValue(e.preferBlob,!1),n=g.defaultValue(e.flipY,!1);if(Q(this.request),!J||this.isDataUri||this.isBlobUri||!this.hasHeaders&&!r)return $({resource:this,flipY:n,preferImageBitmap:t});var i,o,s,u=this.fetchBlob();return g.defined(u)?W.supportsImageBitmapOptions().then(function(e){return i=e&&t,u}).then(function(e){if(g.defined(e)){if(s=e,i)return W.createImageBitmapFromBlob(e,{flipY:n,premultiplyAlpha:!1});e=window.URL.createObjectURL(e);return $({resource:o=new W({url:e}),flipY:n,preferImageBitmap:!1})}}).then(function(e){if(g.defined(e))return e.blob=s,i||window.URL.revokeObjectURL(o.url),e}).otherwise(function(e){return g.defined(o)&&window.URL.revokeObjectURL(o.url),e.blob=s,h.when.reject(e)}):void 0},W.fetchImage=function(e){return new W(e).fetchImage({flipY:e.flipY,preferBlob:e.preferBlob,preferImageBitmap:e.preferImageBitmap})},W.prototype.fetchText=function(){return this.fetch({responseType:"text"})},W.fetchText=function(e){return new W(e).fetchText()},W.prototype.fetchJson=function(){var e=this.fetch({responseType:"text",headers:{Accept:"application/json,*/*;q=0.01"}});if(g.defined(e))return e.then(function(e){if(g.defined(e))return JSON.parse(e)})},W.fetchJson=function(e){return new W(e).fetchJson()},W.prototype.fetchXML=function(){return this.fetch({responseType:"document",overrideMimeType:"text/xml"})},W.fetchXML=function(e){return new W(e).fetchXML()},W.prototype.fetchJsonp=function(e){var t;for(e=g.defaultValue(e,"callback"),Q(this.request);t="loadJsonp"+Math.random().toString().substring(2,8),g.defined(window[t]););return function r(n,i,o){var e={};e[i]=o;n.setQueryParameters(e);var s=n.request;s.url=n.url;s.requestFunction=function(){var t=h.when.defer();return window[o]=function(e){t.resolve(e);try{delete window[o]}catch(e){window[o]=void 0}},W._Implementations.loadAndExecuteScript(n.url,o,t),t.promise};var e=P.request(s);if(!g.defined(e))return;return e.otherwise(function(t){return s.state!==w.FAILED?h.when.reject(t):n.retryOnError(t).then(function(e){return e?(s.state=w.UNISSUED,s.deferred=void 0,r(n,i,o)):h.when.reject(t)})})}(this,e,t)},W.fetchJsonp=function(e){return new W(e).fetchJsonp(e.callbackParameterName)},W.prototype._makeRequest=function(a){var f=this;Q(f.request);var c=f.request;c.url=f.url,c.requestFunction=function(){var e=a.responseType,t=p(a.headers,f.headers),r=a.overrideMimeType,n=a.method,i=a.data,o=h.when.defer(),s=f.url.replace(/\+/g,"%2B"),u=W._Implementations.loadWithXhr(s,e,n,i,t,o,r);return g.defined(u)&&g.defined(u.abort)&&(c.cancelFunction=function(){u.abort()}),o.promise};var e=P.request(c);if(g.defined(e))return e.then(function(e){return c.cancelFunction=void 0,e}).otherwise(function(t){return c.cancelFunction=void 0,c.state!==w.FAILED?h.when.reject(t):f.retryOnError(t).then(function(e){return e?(c.state=w.UNISSUED,c.deferred=void 0,f.fetch(a)):h.when.reject(t)})})};var Z=/^data:(.*?)(;base64)?,(.*)$/;function ee(e,t){t=decodeURIComponent(t);return e?atob(t):t}function te(e,t){for(var r=ee(e,t),t=new ArrayBuffer(r.length),n=new Uint8Array(t),i=0;i<r.length;i++)n[i]=r.charCodeAt(i);return t}function re(e,t){switch(t){case"text":return e.toString("utf8");case"json":return JSON.parse(e.toString("utf8"));default:return new Uint8Array(e).buffer}}W.prototype.fetch=function(e){return(e=z(e,{})).method="GET",this._makeRequest(e)},W.fetch=function(e){return new W(e).fetch({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},W.prototype.delete=function(e){return(e=z(e,{})).method="DELETE",this._makeRequest(e)},W.delete=function(e){return new W(e).delete({responseType:e.responseType,overrideMimeType:e.overrideMimeType,data:e.data})},W.prototype.head=function(e){return(e=z(e,{})).method="HEAD",this._makeRequest(e)},W.head=function(e){return new W(e).head({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},W.prototype.options=function(e){return(e=z(e,{})).method="OPTIONS",this._makeRequest(e)},W.options=function(e){return new W(e).options({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},W.prototype.post=function(e,t){return r.Check.defined("data",e),(t=z(t,{})).method="POST",t.data=e,this._makeRequest(t)},W.post=function(e){return new W(e).post(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},W.prototype.put=function(e,t){return r.Check.defined("data",e),(t=z(t,{})).method="PUT",t.data=e,this._makeRequest(t)},W.put=function(e){return new W(e).put(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},W.prototype.patch=function(e,t){return r.Check.defined("data",e),(t=z(t,{})).method="PATCH",t.data=e,this._makeRequest(t)},W.patch=function(e){return new W(e).patch(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},(W._Implementations={}).createImage=function(o,s,u,a,f){var c=o.url;W.supportsImageBitmapOptions().then(function(e){if(!e||!f)return n=c,e=s,t=u,(r=new Image).onload=function(){t.resolve(r)},r.onerror=function(e){t.reject(e)},e&&(k.contains(n)?r.crossOrigin="use-credentials":r.crossOrigin=""),void(r.src=n);var t,r,n=h.when.defer(),i=W._Implementations.loadWithXhr(c,"blob","GET",void 0,void 0,n,void 0,void 0,void 0);return g.defined(i)&&g.defined(i.abort)&&(o.cancelFunction=function(){i.abort()}),n.promise.then(function(e){return g.defined(e)?W.createImageBitmapFromBlob(e,{flipY:a,premultiplyAlpha:!1}):void u.reject(new q.RuntimeError("Successfully retrieved "+c+" but it contained no content."))}).then(u.resolve)}).otherwise(u.reject)},W.createImageBitmapFromBlob=function(e,t){return r.Check.defined("options",t),r.Check.typeOf.bool("options.flipY",t.flipY),r.Check.typeOf.bool("options.premultiplyAlpha",t.premultiplyAlpha),createImageBitmap(e,{imageOrientation:t.flipY?"flipY":"none",premultiplyAlpha:t.premultiplyAlpha?"premultiply":"none"})};var ne="undefined"==typeof XMLHttpRequest;W._Implementations.loadWithXhr=function(e,i,o,t,r,s,n){var u=Z.exec(e);if(null===u){if(ne)return a=e,f=i,c=o,h=r,p=s,l=require("url").parse(a),a="https:"===l.protocol?require("https"):require("http"),d=require("zlib"),h={protocol:l.protocol,hostname:l.hostname,port:l.port,path:l.path,query:l.query,method:c,headers:h},void a.request(h).on("response",function(t){var r;t.statusCode<200||300<=t.statusCode?p.reject(new R(t.statusCode,t,t.headers)):(r=[],t.on("data",function(e){r.push(e)}),t.on("end",function(){var e=Buffer.concat(r);"gzip"===t.headers["content-encoding"]?d.gunzip(e,function(e,t){e?p.reject(new q.RuntimeError("Error decompressing response.")):p.resolve(re(t,f))}):p.resolve(re(e,f))}))}).on("error",function(e){p.reject(new R)}).end();var a,f,c,h,p,l,d,m=new XMLHttpRequest;if(k.contains(e)&&(m.withCredentials=!0),m.open(o,e,!0),g.defined(n)&&g.defined(m.overrideMimeType)&&m.overrideMimeType(n),g.defined(r))for(var y in r)r.hasOwnProperty(y)&&m.setRequestHeader(y,r[y]);g.defined(i)&&(m.responseType=i);var v=!1;return"string"==typeof e&&(v=0===e.indexOf("file://")||"undefined"!=typeof window&&"file://"===window.location.origin),m.onload=function(){if(!(m.status<200||300<=m.status)||v&&0===m.status){var e=m.response,t=m.responseType;if("HEAD"===o||"OPTIONS"===o){var r=m.getAllResponseHeaders().trim().split(/[\r\n]+/),n={};return r.forEach(function(e){var t=e.split(": "),e=t.shift();n[e]=t.join(": ")}),void s.resolve(n)}if(204===m.status)s.resolve();else if(!g.defined(e)||g.defined(i)&&t!==i)if("json"===i&&"string"==typeof e)try{s.resolve(JSON.parse(e))}catch(e){s.reject(e)}else(""===t||"document"===t)&&g.defined(m.responseXML)&&m.responseXML.hasChildNodes()?s.resolve(m.responseXML):""!==t&&"text"!==t||!g.defined(m.responseText)?s.reject(new q.RuntimeError("Invalid XMLHttpRequest response type.")):s.resolve(m.responseText);else s.resolve(e)}else s.reject(new R(m.status,m.response,m.getAllResponseHeaders()))},m.onerror=function(e){s.reject(new R)},m.send(t),m}s.resolve(function(e,t){t=g.defaultValue(t,"");var r=e[1],n=!!e[2],i=e[3];switch(t){case"":case"text":return ee(n,i);case"arraybuffer":return te(n,i);case"blob":var o=te(n,i);return new Blob([o],{type:r});case"document":return(new DOMParser).parseFromString(ee(n,i),r);case"json":return JSON.parse(ee(n,i))}}(u,i))},W._Implementations.loadAndExecuteScript=function(e,t,r){return function(e){var t=h.when.defer(),r=document.createElement("script");r.async=!0,r.src=e;var n=document.getElementsByTagName("head")[0];return r.onload=function(){r.onload=void 0,n.removeChild(r),t.resolve()},r.onerror=function(e){t.reject(e)},n.appendChild(r),t.promise}(e).otherwise(r.reject)},(W._DefaultImplementations={}).createImage=W._Implementations.createImage,W._DefaultImplementations.loadWithXhr=W._Implementations.loadWithXhr,W._DefaultImplementations.loadAndExecuteScript=W._Implementations.loadAndExecuteScript,W.DEFAULT=Object.freeze(new W({url:"undefined"==typeof document?"":document.location.href.split("?")[0]}));var ie,oe,se,ue=/((?:.*\/)|^)LSGlobe\.js(?:\?|\#|$)/;function ae(e){return"undefined"==typeof document?e:(g.defined(ie)||(ie=document.createElement("a")),ie.href=e,ie.href=ie.href,ie.href)}function fe(){if(g.defined(oe))return oe;var e="undefined"!=typeof CESIUM_BASE_URL?CESIUM_BASE_URL:"object"==typeof define&&g.defined(define.amd)&&!define.amd.toUrlUndefined&&g.defined(require.toUrl)?l("..",pe("Core/buildModuleUrl.js")):function(){for(var e=document.getElementsByTagName("script"),t=0,r=e.length;t<r;++t){var n=e[t].getAttribute("src"),n=ue.exec(n);if(null!==n)return n[1]}}();return(oe=new W({url:ae(e)})).appendForwardSlash(),oe}function ce(e){return ae(require.toUrl("../"+e))}function he(e){return fe().getDerivedResource({url:e}).url}function pe(e){return g.defined(se)||(se="object"==typeof define&&g.defined(define.amd)&&!define.amd.toUrlUndefined&&g.defined(require.toUrl)?ce:he),se(e)}pe._cesiumScriptRegex=ue,pe._buildModuleUrlFromBaseUrl=he,pe._clearBaseResource=function(){oe=void 0},pe.setBaseUrl=function(e){oe=W.DEFAULT.getDerivedResource({url:e})},pe.getCesiumBaseUrl=fe,e.Resource=W,e.buildModuleUrl=pe});
