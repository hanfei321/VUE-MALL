define(["./defaultValue-bcb5baf7","./DeveloperError-b273b01a","./Check-f9a1a1be","./Math-588d98f6","./Cartesian2-10213add","./Rectangle-de996bfb","./Transforms-2b063051","./Matrix4-c981b715","./RuntimeError-1b5fbc4d","./WebGLConstants-667a4a5e","./ComponentDatatype-ec1abf38","./when-ae2a7552","./buildModuleUrl-cd6b3599","./AttributeCompression-8a5fa32d","./IndexDatatype-523f50d6","./IntersectionTests-cc1722b0","./Plane-bb97f210","./WebMercatorProjection-d1a748fe","./createTaskProcessorWorker","./EllipsoidTangentPlane-86347fa6","./OrientedBoundingBox-6de788ea","./TerrainEncoding-a5a06c70"],function(ie,e,t,oe,ae,se,de,ce,r,n,i,o,a,ue,he,s,d,le,c,Ie,me,ge){"use strict";function Te(){e.DeveloperError.throwInstantiationError()}Object.defineProperties(Te.prototype,{errorEvent:{get:e.DeveloperError.throwInstantiationError},credit:{get:e.DeveloperError.throwInstantiationError},tilingScheme:{get:e.DeveloperError.throwInstantiationError},ready:{get:e.DeveloperError.throwInstantiationError},readyPromise:{get:e.DeveloperError.throwInstantiationError},hasWaterMask:{get:e.DeveloperError.throwInstantiationError},hasVertexNormals:{get:e.DeveloperError.throwInstantiationError},availability:{get:e.DeveloperError.throwInstantiationError}});var u=[];Te.getRegularGridIndices=function(e,t){var r=u[e];ie.defined(r)||(u[e]=r=[]);var n=r[t];return ie.defined(n)||m(e,t,n=e*t<oe.CesiumMath.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6):r[t]=new Uint32Array((e-1)*(t-1)*6),0),n};var h=[];Te.getRegularGridIndicesAndEdgeIndices=function(e,t){var r=h[e];ie.defined(r)||(h[e]=r=[]);var n,i,o,a,s=r[t];return ie.defined(s)||(n=Te.getRegularGridIndices(e,t),i=(a=I(e,t)).westIndicesSouthToNorth,o=a.southIndicesEastToWest,e=a.eastIndicesNorthToSouth,a=a.northIndicesWestToEast,s=r[t]={indices:n,westIndicesSouthToNorth:i,southIndicesEastToWest:o,eastIndicesNorthToSouth:e,northIndicesWestToEast:a}),s};var l=[];function I(e,t){for(var r=new Array(t),n=new Array(e),i=new Array(t),o=new Array(e),a=0;a<e;++a)n[o[a]=a]=e*t-1-a;for(a=0;a<t;++a)i[a]=(a+1)*e-1,r[a]=(t-a-1)*e;return{westIndicesSouthToNorth:r,southIndicesEastToWest:n,eastIndicesNorthToSouth:i,northIndicesWestToEast:o}}function m(e,t,r,n){for(var i=0,o=0;o<t-1;++o){for(var a=0;a<e-1;++a){var s=i+e,d=s+1,c=i+1;r[n++]=i,r[n++]=s,r[n++]=c,r[n++]=c,r[n++]=s,r[n++]=d,++i}++i}}function g(e,t,r,n){for(var i=e[0],o=e.length,a=1;a<o;++a){var s=e[a];r[n++]=i,r[n++]=s,r[n++]=t,r[n++]=t,r[n++]=s,r[n++]=t+1,i=s,++t}return n}Te.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){var r=l[e];ie.defined(r)||(l[e]=r=[]);var n,i,o,a,s,d,c,u,h=r[t];return ie.defined(h)||(o=(n=e*t)+(d=2*e+2*t),u=(i=(e-1)*(t-1)*6)+6*Math.max(0,d-4),a=(c=I(e,t)).westIndicesSouthToNorth,s=c.southIndicesEastToWest,d=c.eastIndicesNorthToSouth,c=c.northIndicesWestToEast,m(e,t,u=he.IndexDatatype.createTypedArray(o,u),0),Te.addSkirtIndices(a,s,d,c,n,u,i),h=r[t]={indices:u,westIndicesSouthToNorth:a,southIndicesEastToWest:s,eastIndicesNorthToSouth:d,northIndicesWestToEast:c,indexCountWithoutSkirts:i}),h},Te.addSkirtIndices=function(e,t,r,n,i,o,a){a=g(e,i,o,a),a=g(t,i+=e.length,o,a),a=g(r,i+=t.length,o,a),g(n,i+=r.length,o,a)},Te.heightmapTerrainQuality=.25,Te.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,r){return 2*e.maximumRadius*Math.PI*Te.heightmapTerrainQuality/(t*r)},Te.prototype.requestTileGeometry=e.DeveloperError.throwInstantiationError,Te.prototype.getLevelMaximumGeometricError=e.DeveloperError.throwInstantiationError,Te.prototype.getTileDataAvailable=e.DeveloperError.throwInstantiationError,Te.prototype.loadTileDataAvailability=e.DeveloperError.throwInstantiationError;var pe=32767,Ee=new ae.Cartesian3,fe=new ae.Cartesian3,ye=new ae.Cartesian3,ve=new ae.Cartographic,be=new ae.Cartesian2,Ne=new ae.Cartesian3,we=new ce.Matrix4,xe=new ce.Matrix4;function Me(e,t,r,n,i,o,a,s,d){var c=Number.POSITIVE_INFINITY,u=i.north,h=i.south,l=i.east,I=i.west;l<I&&(l+=oe.CesiumMath.TWO_PI);for(var m=e.length,g=0;g<m;++g){var T=e[g],p=r[T],T=n[T];ve.longitude=oe.CesiumMath.lerp(I,l,T.x),ve.latitude=oe.CesiumMath.lerp(h,u,T.y),ve.height=p-t;p=o.cartographicToCartesian(ve,Ee);ce.Matrix4.multiplyByPoint(a,p,p),ae.Cartesian3.minimumByComponent(p,s,s),ae.Cartesian3.maximumByComponent(p,d,d),c=Math.min(c,ve.height)}return c}function Ce(e,t,r,n,i,o,a,s,d,c,u,h,l,I,m){var g=ie.defined(a),T=d.north,p=d.south,E=d.east,f=d.west;E<f&&(E+=oe.CesiumMath.TWO_PI);for(var y=r.length,v=0;v<y;++v){var b=r[v],N=i[b],w=o[b];ve.longitude=oe.CesiumMath.lerp(f,E,w.x)+I,ve.latitude=oe.CesiumMath.lerp(p,T,w.y)+m,ve.height=N-c;var x,M,C=s.cartographicToCartesian(ve,Ee);g&&(x=2*b,be.x=a[x],be.y=a[1+x],1!==u&&(N=ue.AttributeCompression.octDecode(be.x,be.y,Ne),b=de.Transforms.eastNorthUpToFixedFrame(Ee,s,xe),x=ce.Matrix4.inverseTransformation(b,we),ce.Matrix4.multiplyByPointAsVector(x,N,N),N.z*=u,ae.Cartesian3.normalize(N,N),ce.Matrix4.multiplyByPointAsVector(b,N,N),ae.Cartesian3.normalize(N,N),ue.AttributeCompression.octEncode(N,be))),n.hasWebMercatorT&&(M=(le.WebMercatorProjection.geodeticLatitudeToMercatorAngle(ve.latitude)-h)*l),t=n.encode(e,t,C,w,ve.height,be,M)}}function Se(e,t){var r;return"function"==typeof e.slice&&"function"!=typeof(r=e.slice()).sort&&(r=void 0),ie.defined(r)||(r=Array.prototype.slice.call(e)),r.sort(t),r}return c(function(e,t){var r,n,i=(ne=e.quantizedVertices).length/3,o=e.octEncodedNormals,a=e.westIndices.length+e.eastIndices.length+e.southIndices.length+e.northIndices.length,s=e.includeWebMercatorT,d=se.Rectangle.clone(e.rectangle),c=d.west,u=d.south,h=d.east,l=d.north,I=se.Ellipsoid.clone(e.ellipsoid),m=e.exaggeration,g=e.minimumHeight*m,T=e.maximumHeight*m,p=e.relativeToCenter,E=de.Transforms.eastNorthUpToFixedFrame(p,I),f=ce.Matrix4.inverseTransformation(E,new ce.Matrix4);s&&(r=le.WebMercatorProjection.geodeticLatitudeToMercatorAngle(u),n=1/(le.WebMercatorProjection.geodeticLatitudeToMercatorAngle(l)-r));var y=ne.subarray(0,i),v=ne.subarray(i,2*i),b=ne.subarray(2*i,3*i),N=ie.defined(o),w=new Array(i),x=new Array(i),M=new Array(i),C=s?new Array(i):[],S=fe;S.x=Number.POSITIVE_INFINITY,S.y=Number.POSITIVE_INFINITY,S.z=Number.POSITIVE_INFINITY;var A=ye;A.x=Number.NEGATIVE_INFINITY,A.y=Number.NEGATIVE_INFINITY,A.z=Number.NEGATIVE_INFINITY;for(var P=Number.POSITIVE_INFINITY,W=Number.NEGATIVE_INFINITY,D=Number.POSITIVE_INFINITY,B=Number.NEGATIVE_INFINITY,F=0;F<i;++F){var k=y[F],V=v[F],_=k/pe,H=V/pe,k=oe.CesiumMath.lerp(g,T,b[F]/pe);ve.longitude=oe.CesiumMath.lerp(c,h,_),ve.latitude=oe.CesiumMath.lerp(u,l,H),ve.height=k,P=Math.min(ve.longitude,P),W=Math.max(ve.longitude,W),D=Math.min(ve.latitude,D),B=Math.max(ve.latitude,B);V=I.cartographicToCartesian(ve);w[F]=new ae.Cartesian2(_,H),x[F]=k,M[F]=V,s&&(C[F]=(le.WebMercatorProjection.geodeticLatitudeToMercatorAngle(ve.latitude)-r)*n),ce.Matrix4.multiplyByPoint(f,V,Ee),ae.Cartesian3.minimumByComponent(Ee,S,S),ae.Cartesian3.maximumByComponent(Ee,A,A)}var O,G,Y,z=Se(e.westIndices,function(e,t){return w[e].y-w[t].y}),R=Se(e.eastIndices,function(e,t){return w[t].y-w[e].y}),L=Se(e.southIndices,function(e,t){return w[t].x-w[e].x}),U=Se(e.northIndices,function(e,t){return w[e].x-w[t].x});1!==m&&(G=de.BoundingSphere.fromPoints(M),O=me.OrientedBoundingBox.fromRectangle(d,g,T,I)),(1!==m||g<0)&&(Y=new ge.EllipsoidalOccluder(I).computeHorizonCullingPointPossiblyUnderEllipsoid(p,M,g));var j=g,j=Math.min(j,Me(e.westIndices,e.westSkirtHeight,x,w,d,I,f,S,A));j=Math.min(j,Me(e.southIndices,e.southSkirtHeight,x,w,d,I,f,S,A)),j=Math.min(j,Me(e.eastIndices,e.eastSkirtHeight,x,w,d,I,f,S,A)),j=Math.min(j,Me(e.northIndices,e.northSkirtHeight,x,w,d,I,f,S,A));for(var q,Q,K,X=new Ie.AxisAlignedBoundingBox(S,A,p),Z=new ge.TerrainEncoding(X,j,T,E,N,s),J=Z.getStride(),$=new Float32Array(i*J+a*J),ee=0,te=0;te<i;++te)N&&(K=2*te,be.x=o[K],be.y=o[1+K],1!==m&&(q=ue.AttributeCompression.octDecode(be.x,be.y,Ne),Q=de.Transforms.eastNorthUpToFixedFrame(M[te],I,xe),K=ce.Matrix4.inverseTransformation(Q,we),ce.Matrix4.multiplyByPointAsVector(K,q,q),q.z*=m,ae.Cartesian3.normalize(q,q),ce.Matrix4.multiplyByPointAsVector(Q,q,q),ae.Cartesian3.normalize(q,q),ue.AttributeCompression.octEncode(q,be))),ee=Z.encode($,ee,M[te],w[te],x[te],be,C[te]);var re=Math.max(0,2*(a-4)),ne=e.indices.length+3*re;return(X=he.IndexDatatype.createTypedArray(i+a,ne)).set(e.indices,0),re=-(j=1e-4*(W-P)),a=j,j=-(ne=E=1e-4*(B-D)),Ce($,E=i*J,z,Z,x,w,o,I,d,e.westSkirtHeight,m,r,n,re,0),Ce($,E+=e.westIndices.length*J,L,Z,x,w,o,I,d,e.southSkirtHeight,m,r,n,0,j),Ce($,E+=e.southIndices.length*J,R,Z,x,w,o,I,d,e.eastSkirtHeight,m,r,n,a,0),Ce($,E+=e.eastIndices.length*J,U,Z,x,w,o,I,d,e.northSkirtHeight,m,r,n,0,ne),Te.addSkirtIndices(z,L,R,U,i,X,e.indices.length),t.push($.buffer,X.buffer),{vertices:$.buffer,indices:X.buffer,westIndicesSouthToNorth:z,southIndicesEastToWest:L,eastIndicesNorthToSouth:R,northIndicesWestToEast:U,vertexStride:J,center:p,minimumHeight:g,maximumHeight:T,boundingSphere:G,orientedBoundingBox:O,occludeePointInScaledSpace:Y,encoding:Z,indexCountWithoutSkirts:e.indices.length}})});
