define(["./defaultValue-bcb5baf7","./when-ae2a7552","./createTaskProcessorWorker"],function(p,t,e){"use strict";function ht(){}var i,o;ht.inherits=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t},ht.nullFunction=function(){},(ht.has=function(){}).CANVAS_LINE_DASH=!0,(ht.extent=function(){}).Relationship={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16},ht.extent.boundingExtent=function(t){for(var e=ht.extent.createEmpty(),r=0,n=t.length;r<n;++r)ht.extent.extendCoordinate(e,t[r]);return e},ht.extent.boundingExtentXYs_=function(t,e,r){var n=Math.min.apply(null,t),i=Math.min.apply(null,e),t=Math.max.apply(null,t),e=Math.max.apply(null,e);return ht.extent.createOrUpdate(n,i,t,e,r)},ht.extent.buffer=function(t,e,r){return r?(r[0]=t[0]-e,r[1]=t[1]-e,r[2]=t[2]+e,r[3]=t[3]+e,r):[t[0]-e,t[1]-e,t[2]+e,t[3]+e]},ht.extent.clone=function(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t.slice()},ht.extent.closestSquaredDistanceXY=function(t,e,r){e=e<t[0]?t[0]-e:t[2]<e?e-t[2]:0,t=r<t[1]?t[1]-r:t[3]<r?r-t[3]:0;return e*e+t*t},ht.extent.containsCoordinate=function(t,e){return ht.extent.containsXY(t,e[0],e[1])},ht.extent.containsExtent=function(t,e){return t[0]<=e[0]&&e[2]<=t[2]&&t[1]<=e[1]&&e[3]<=t[3]},ht.extent.containsXY=function(t,e,r){return t[0]<=e&&e<=t[2]&&t[1]<=r&&r<=t[3]},ht.extent.coordinateRelationship=function(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],s=e[0],t=e[1],e=ht.extent.Relationship.UNKNOWN;return s<r?e|=ht.extent.Relationship.LEFT:i<s&&(e|=ht.extent.Relationship.RIGHT),t<n?e|=ht.extent.Relationship.BELOW:o<t&&(e|=ht.extent.Relationship.ABOVE),e===ht.extent.Relationship.UNKNOWN&&(e=ht.extent.Relationship.INTERSECTING),e},ht.extent.createEmpty=function(){return[1/0,1/0,-1/0,-1/0]},ht.extent.createOrUpdate=function(t,e,r,n,i){return i?(i[0]=t,i[1]=e,i[2]=r,i[3]=n,i):[t,e,r,n]},ht.extent.createOrUpdateEmpty=function(t){return ht.extent.createOrUpdate(1/0,1/0,-1/0,-1/0,t)},ht.extent.createOrUpdateFromCoordinate=function(t,e){var r=t[0],t=t[1];return ht.extent.createOrUpdate(r,t,r,t,e)},ht.extent.createOrUpdateFromCoordinates=function(t,e){e=ht.extent.createOrUpdateEmpty(e);return ht.extent.extendCoordinates(e,t)},ht.extent.createOrUpdateFromFlatCoordinates=function(t,e,r,n,i){i=ht.extent.createOrUpdateEmpty(i);return ht.extent.extendFlatCoordinates(i,t,e,r,n)},ht.extent.createOrUpdateFromRings=function(t,e){e=ht.extent.createOrUpdateEmpty(e);return ht.extent.extendRings(e,t)},ht.extent.equals=function(t,e){return t[0]==e[0]&&t[2]==e[2]&&t[1]==e[1]&&t[3]==e[3]},ht.extent.extend=function(t,e){return e[0]<t[0]&&(t[0]=e[0]),e[2]>t[2]&&(t[2]=e[2]),e[1]<t[1]&&(t[1]=e[1]),e[3]>t[3]&&(t[3]=e[3]),t},ht.extent.extendCoordinate=function(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])},ht.extent.extendCoordinates=function(t,e){for(var r=0,n=e.length;r<n;++r)ht.extent.extendCoordinate(t,e[r]);return t},ht.extent.extendFlatCoordinates=function(t,e,r,n,i){for(;r<n;r+=i)ht.extent.extendXY(t,e[r],e[r+1]);return t},ht.extent.extendRings=function(t,e){for(var r=0,n=e.length;r<n;++r)ht.extent.extendCoordinates(t,e[r]);return t},ht.extent.extendXY=function(t,e,r){t[0]=Math.min(t[0],e),t[1]=Math.min(t[1],r),t[2]=Math.max(t[2],e),t[3]=Math.max(t[3],r)},ht.extent.forEachCorner=function(t,e,r){var n=e.call(r,ht.extent.getBottomLeft(t));return n||((n=e.call(r,ht.extent.getBottomRight(t)))||(n=e.call(r,ht.extent.getTopRight(t)))?n:(n=e.call(r,ht.extent.getTopLeft(t)))||!1)},ht.extent.getArea=function(t){var e=0;return ht.extent.isEmpty(t)||(e=ht.extent.getWidth(t)*ht.extent.getHeight(t)),e},ht.extent.getBottomLeft=function(t){return[t[0],t[1]]},ht.extent.getBottomRight=function(t){return[t[2],t[1]]},ht.extent.getCenter=function(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]},ht.extent.getCorner=function(t,e){var r;return e===ht.extent.Corner.BOTTOM_LEFT?r=ht.extent.getBottomLeft(t):e===ht.extent.Corner.BOTTOM_RIGHT?r=ht.extent.getBottomRight(t):e===ht.extent.Corner.TOP_LEFT?r=ht.extent.getTopLeft(t):e===ht.extent.Corner.TOP_RIGHT?r=ht.extent.getTopRight(t):ht.asserts.assert(!1,13),r},ht.extent.getEnlargedArea=function(t,e){var r=Math.min(t[0],e[0]),n=Math.min(t[1],e[1]);return(Math.max(t[2],e[2])-r)*(Math.max(t[3],e[3])-n)},ht.extent.getForViewAndSize=function(t,e,r,n,i){var o=e*n[0]/2,s=e*n[1]/2,a=Math.cos(r),l=Math.sin(r),h=o*a,u=o*l,e=s*a,n=s*l,r=t[0],o=t[1],a=r-h+n,s=r-h-n,l=r+h-n,t=r+h+n,r=o-u-e,h=o-u+e,n=o+u+e,e=o+u-e;return ht.extent.createOrUpdate(Math.min(a,s,l,t),Math.min(r,h,n,e),Math.max(a,s,l,t),Math.max(r,h,n,e),i)},ht.extent.getHeight=function(t){return t[3]-t[1]},ht.extent.getIntersectionArea=function(t,e){e=ht.extent.getIntersection(t,e);return ht.extent.getArea(e)},ht.extent.getIntersection=function(t,e,r){r=r||ht.extent.createEmpty();return ht.extent.intersects(t,e)&&(t[0]>e[0]?r[0]=t[0]:r[0]=e[0],t[1]>e[1]?r[1]=t[1]:r[1]=e[1],t[2]<e[2]?r[2]=t[2]:r[2]=e[2],t[3]<e[3]?r[3]=t[3]:r[3]=e[3]),r},ht.extent.getMargin=function(t){return ht.extent.getWidth(t)+ht.extent.getHeight(t)},ht.extent.getSize=function(t){return[t[2]-t[0],t[3]-t[1]]},ht.extent.getTopLeft=function(t){return[t[0],t[3]]},ht.extent.getTopRight=function(t){return[t[2],t[3]]},ht.extent.getWidth=function(t){return t[2]-t[0]},ht.extent.intersects=function(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]},ht.extent.isEmpty=function(t){return t[2]<t[0]||t[3]<t[1]},ht.extent.returnOrUpdate=function(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t},ht.extent.scaleFromCenter=function(t,e){var r=(t[2]-t[0])/2*(e-1),e=(t[3]-t[1])/2*(e-1);t[0]-=r,t[2]+=r,t[1]-=e,t[3]+=e},ht.extent.intersectsSegment=function(t,e,r){var n,i,o,s,a,l,h,u=!1,c=ht.extent.coordinateRelationship(t,e),d=ht.extent.coordinateRelationship(t,r);return c===ht.extent.Relationship.INTERSECTING||d===ht.extent.Relationship.INTERSECTING?u=!0:(n=t[0],i=t[1],o=t[2],s=t[3],a=e[0],t=e[1],e=r[0],a=((r=r[1])-t)/(e-a),d&ht.extent.Relationship.ABOVE&&!(c&ht.extent.Relationship.ABOVE)&&(u=n<=(l=e-(r-s)/a)&&l<=o),u||!(d&ht.extent.Relationship.RIGHT)||c&ht.extent.Relationship.RIGHT||(u=i<=(h=r-(e-o)*a)&&h<=s),u||!(d&ht.extent.Relationship.BELOW)||c&ht.extent.Relationship.BELOW||(u=n<=(l=e-(r-i)/a)&&l<=o),u||!(d&ht.extent.Relationship.LEFT)||c&ht.extent.Relationship.LEFT||(u=i<=(h=r-(e-n)*a)&&h<=s)),u},ht.extent.applyTransform=function(t,e,r){t=[t[0],t[1],t[0],t[3],t[2],t[1],t[2],t[3]];e(t,t,2);e=[t[0],t[2],t[4],t[6]],t=[t[1],t[3],t[5],t[7]];return ht.extent.boundingExtentXYs_(e,t,r)},(ht.obj=function(){}).assign="function"==typeof Object.assign?Object.assign:function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(t),n=1,i=arguments.length;n<i;++n){var o=arguments[n];if(null!=o)for(var s in o)o.hasOwnProperty(s)&&(r[s]=o[s])}return r},ht.obj.clear=function(t){for(var e in t)delete t[e]},ht.obj.getValues=function(t){var e,r=[];for(e in t)r.push(t[e]);return r},ht.obj.isEmpty=function(t){for(var e in t)return!1;return!e},(ht.array=function(){}).binarySearch=function(t,e,r){for(var n,i,o=r||ht.array.numberSafeCompareFunction,s=0,a=t.length,l=!1;s<a;)(i=+o(t[n=s+(a-s>>1)],e))<0?s=n+1:(a=n,l=!i);return l?s:~s},ht.array.numberSafeCompareFunction=function(t,e){return e<t?1:t<e?-1:0},ht.array.includes=function(t,e){return 0<=t.indexOf(e)},ht.array.linearFindNearest=function(t,e,r){var n,i=t.length;if(t[0]<=e)return 0;if(e<=t[i-1])return i-1;if(0<r){for(n=1;n<i;++n)if(t[n]<e)return n-1}else if(r<0){for(n=1;n<i;++n)if(t[n]<=e)return n}else for(n=1;n<i;++n){if(t[n]==e)return n;if(t[n]<e)return t[n-1]-e<e-t[n]?n-1:n}return i-1},ht.array.reverseSubArray=function(t,e,r){for(;e<r;){var n=t[e];t[e]=t[r],t[r]=n,++e,--r}},ht.array.extend=function(t,e){for(var r=Array.isArray(e)?e:[e],n=r.length,i=0;i<n;i++)t[t.length]=r[i]},ht.array.remove=function(t,e){var r=t.indexOf(e),e=-1<r;return e&&t.splice(r,1),e},ht.array.find=function(t,e){for(var r,n=t.length>>>0,i=0;i<n;i++)if(e(r=t[i],i,t))return r;return null},ht.array.equals=function(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0},ht.array.stableSort=function(t,r){for(var e=t.length,n=Array(t.length),i=0;i<e;i++)n[i]={index:i,value:t[i]};for(n.sort(function(t,e){return r(t.value,e.value)||t.index-e.index}),i=0;i<t.length;i++)t[i]=n[i].value},ht.array.findIndex=function(r,n){var i;return!r.every(function(t,e){return!n(t,i=e,r)})?i:-1},ht.array.isSorted=function(r,t,n){var i=t||ht.array.numberSafeCompareFunction;return r.every(function(t,e){if(0===e)return!0;t=i(r[e-1],t);return!(0<t||n&&0===t)})},(ht.color=function(){}).HEX_COLOR_RE_=/^#(?:[0-9a-f]{3}){1,2}$/i,ht.color.NAMED_COLOR_RE_=/^([a-z]*)$/i,ht.color.asArray=function(t){return Array.isArray(t)?t:ht.color.fromString(t)},ht.color.asString=function(t){return"string"==typeof t?t:ht.color.toString(t)},ht.color.fromString=(i={},o=0,function(t){var e;if(i.hasOwnProperty(t))e=i[t];else{if(1024<=o){var r,n=0;for(r in i)0==(3&n++)&&(delete i[r],--o)}e=ht.color.fromStringInternal_(t),i[t]=e,++o}return e}),ht.color.fromStringInternal_=function(t){var e,r,n,i,o;return ht.color.NAMED_COLOR_RE_.exec(t)&&(t=ht.color.fromNamed(t)),ht.color.HEX_COLOR_RE_.exec(t)?(o=t.length-1,ht.asserts.assert(3==o||6==o,54),r=3==o?1:2,n=parseInt(t.substr(1+0*r,r),16),i=parseInt(t.substr(1+r,r),16),o=parseInt(t.substr(1+2*r,r),16),1==r&&(n=(n<<4)+n,i=(i<<4)+i,o=(o<<4)+o),o=[n,i,o,1]):0==t.indexOf("rgba(")?(e=t.slice(5,-1).split(",").map(Number),o=ht.color.normalize(e)):0==t.indexOf("rgb(")?((e=t.slice(4,-1).split(",").map(Number)).push(1),o=ht.color.normalize(e)):ht.asserts.assert(!1,14),o},ht.color.normalize=function(t,e){e=e||[];return e[0]=ht.math.clamp(t[0]+.5|0,0,255),e[1]=ht.math.clamp(t[1]+.5|0,0,255),e[2]=ht.math.clamp(t[2]+.5|0,0,255),e[3]=ht.math.clamp(t[3],0,1),e},ht.color.toString=function(t){var e=t[0];e!=(0|e)&&(e=e+.5|0);var r=t[1];r!=(0|r)&&(r=r+.5|0);var n=t[2];return n!=(0|n)&&(n=n+.5|0),"rgba("+e+","+r+","+n+","+(void 0===t[3]?1:t[3])+")"},(ht.colorlike=function(){}).asColorLike=function(t){return ht.colorlike.isColorLike(t)?t:ht.color.asString(t)},ht.colorlike.isColorLike=function(t){return"string"==typeof t||t instanceof CanvasPattern||t instanceof CanvasGradient},(ht.proj=function(){}).Units={DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},ht.proj.Units.METERS_PER_UNIT={},ht.proj.Units.METERS_PER_UNIT[ht.proj.Units.DEGREES]=2*Math.PI*6370997/360,ht.proj.Units.METERS_PER_UNIT[ht.proj.Units.FEET]=.3048,ht.proj.Units.METERS_PER_UNIT[ht.proj.Units.METERS]=1,ht.proj.Units.METERS_PER_UNIT[ht.proj.Units.USFEET]=1200/3937,ht.proj.proj4=function(){},ht.proj.proj4.cache_=null,ht.proj.proj4.set=function(t){ht.proj.proj4.cache_=t},ht.proj.Projection=function(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit;var e,r=t.code;ht.ENABLE_PROJ4JS&&("function"!=typeof(e=ht.proj.proj4.get())||void 0!==(r=e.defs(r))&&(void 0!==r.axis&&void 0===t.axisOrientation&&(this.axisOrientation_=r.axis),void 0===t.metersPerUnit&&(this.metersPerUnit_=r.to_meter),void 0===t.units&&(this.units_=r.units)))},ht.proj.Projection.prototype.canWrapX=function(){return this.canWrapX_},ht.proj.Projection.prototype.getCode=function(){return this.code_},ht.proj.Projection.prototype.getExtent=function(){return this.extent_},ht.proj.Projection.prototype.getUnits=function(){return this.units_},ht.proj.Projection.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||ht.proj.Units.METERS_PER_UNIT[this.units_]},ht.proj.Projection.prototype.getWorldExtent=function(){return this.worldExtent_},ht.proj.Projection.prototype.getAxisOrientation=function(){return this.axisOrientation_},ht.proj.Projection.prototype.isGlobal=function(){return this.global_},ht.proj.Projection.prototype.setGlobal=function(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)},ht.proj.Projection.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},ht.proj.Projection.prototype.setDefaultTileGrid=function(t){this.defaultTileGrid_=t},ht.proj.Projection.prototype.setExtent=function(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)},ht.proj.Projection.prototype.setWorldExtent=function(t){this.worldExtent_=t},ht.proj.Projection.prototype.setGetPointResolution=function(t){this.getPointResolutionFunc_=t},ht.proj.Projection.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_},(ht.geom=function(){}).GeometryType={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},ht.geom.GeometryLayout={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"},ht.geom.flat=function(){},ht.geom.flat.transform=function(){},ht.geom.flat.transform.transform2D=function(t,e,r,n,i,o){for(var s=o||[],a=0,l=e;l<r;l+=n){var h=t[l],u=t[l+1];s[a++]=i[0]*h+i[2]*u+i[4],s[a++]=i[1]*h+i[3]*u+i[5]}return o&&s.length!=a&&(s.length=a),s},ht.geom.flat.transform.rotate=function(t,e,r,n,i,o,s){for(var a=s||[],l=Math.cos(i),h=Math.sin(i),u=o[0],c=o[1],d=0,f=e;f<r;f+=n){var p=t[f]-u,y=t[f+1]-c;a[d++]=u+p*l-y*h,a[d++]=c+p*h+y*l;for(var g=f+2;g<f+n;++g)a[d++]=t[g]}return s&&a.length!=d&&(a.length=d),a},ht.geom.flat.transform.scale=function(t,e,r,n,i,o,s,a){for(var l=a||[],h=s[0],u=s[1],c=0,d=e;d<r;d+=n){var f=t[d]-h,p=t[d+1]-u;l[c++]=h+i*f,l[c++]=u+o*p;for(var y=d+2;y<d+n;++y)l[c++]=t[y]}return a&&l.length!=c&&(l.length=c),l},ht.geom.flat.transform.translate=function(t,e,r,n,i,o,s){for(var a,l=s||[],h=0,u=e;u<r;u+=n)for(l[h++]=t[u]+i,l[h++]=t[u+1]+o,a=u+2;a<u+n;++a)l[h++]=t[a];return s&&l.length!=h&&(l.length=h),l},(ht.transform=function(){}).tmp_=new Array(6),ht.transform.create=function(){return[1,0,0,1,0,0]},ht.transform.reset=function(t){return ht.transform.set(t,1,0,0,1,0,0)},ht.transform.multiply=function(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=e[0],h=e[1],u=e[2],c=e[3],d=e[4],e=e[5];return t[0]=r*l+i*h,t[1]=n*l+o*h,t[2]=r*u+i*c,t[3]=n*u+o*c,t[4]=r*d+i*e+s,t[5]=n*d+o*e+a,t},ht.transform.set=function(t,e,r,n,i,o,s){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=s,t},ht.transform.setFromArray=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},ht.transform.apply=function(t,e){var r=e[0],n=e[1];return e[0]=t[0]*r+t[2]*n+t[4],e[1]=t[1]*r+t[3]*n+t[5],e},ht.transform.rotate=function(t,e){var r=Math.cos(e),e=Math.sin(e);return ht.transform.multiply(t,ht.transform.set(ht.transform.tmp_,r,e,-e,r,0,0))},ht.transform.scale=function(t,e,r){return ht.transform.multiply(t,ht.transform.set(ht.transform.tmp_,e,0,0,r,0,0))},ht.transform.translate=function(t,e,r){return ht.transform.multiply(t,ht.transform.set(ht.transform.tmp_,1,0,0,1,e,r))},ht.transform.compose=function(t,e,r,n,i,o,s,a){var l=Math.sin(o),o=Math.cos(o);return t[0]=n*o,t[1]=i*l,t[2]=-n*l,t[3]=i*o,t[4]=s*n*o-a*n*l+e,t[5]=s*i*l+a*i*o+r,t},ht.transform.invert=function(t){var e=ht.transform.determinant(t);ht.asserts.assert(0!==e,32);var r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],a=t[5];return t[0]=o/e,t[1]=-n/e,t[2]=-i/e,t[3]=r/e,t[4]=(i*a-o*s)/e,t[5]=-(r*a-n*s)/e,t},ht.transform.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},(ht.style=function(){}).Fill=function(t){t=t||{};this.color_=void 0!==t.color?t.color:null,this.checksum_=void 0},ht.style.Fill.prototype.clone=function(){var t=this.getColor();return new ht.style.Fill({color:t&&t.slice?t.slice():t||void 0})},ht.style.Fill.prototype.getColor=function(){return this.color_},ht.style.Fill.prototype.setColor=function(t){this.color_=t,this.checksum_=void 0},ht.style.Fill.prototype.getChecksum=function(){return void 0===this.checksum_&&(this.color_ instanceof CanvasPattern||this.color_ instanceof CanvasGradient?this.checksum_=ht.getUid(this.color_).toString():this.checksum_="f"+(this.color_?ht.color.asString(this.color_):"-")),this.checksum_},ht.style.Stroke=function(t){t=t||{};this.color_=void 0!==t.color?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=void 0!==t.lineDash?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width,this.checksum_=void 0},ht.style.Stroke.prototype.clone=function(){var t=this.getColor();return new ht.style.Stroke({color:t&&t.slice?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},ht.style.Stroke.prototype.getColor=function(){return this.color_},ht.style.Stroke.prototype.getLineCap=function(){return this.lineCap_},ht.style.Stroke.prototype.getLineDash=function(){return this.lineDash_},ht.style.Stroke.prototype.getLineDashOffset=function(){return this.lineDashOffset_},ht.style.Stroke.prototype.getLineJoin=function(){return this.lineJoin_},ht.style.Stroke.prototype.getMiterLimit=function(){return this.miterLimit_},ht.style.Stroke.prototype.getWidth=function(){return this.width_},ht.style.Stroke.prototype.setColor=function(t){this.color_=t,this.checksum_=void 0},ht.style.Stroke.prototype.setLineCap=function(t){this.lineCap_=t,this.checksum_=void 0},ht.style.Stroke.prototype.setLineDash=function(t){this.lineDash_=t,this.checksum_=void 0},ht.style.Stroke.prototype.setLineDashOffset=function(t){this.lineDashOffset_=t,this.checksum_=void 0},ht.style.Stroke.prototype.setLineJoin=function(t){this.lineJoin_=t,this.checksum_=void 0},ht.style.Stroke.prototype.setMiterLimit=function(t){this.miterLimit_=t,this.checksum_=void 0},ht.style.Stroke.prototype.setWidth=function(t){this.width_=t,this.checksum_=void 0},ht.style.Stroke.prototype.getChecksum=function(){return void 0===this.checksum_&&(this.checksum_="s",this.color_?"string"==typeof this.color_?this.checksum_+=this.color_:this.checksum_+=ht.getUid(this.color_).toString():this.checksum_+="-",this.checksum_+=","+(void 0!==this.lineCap_?this.lineCap_.toString():"-")+","+(this.lineDash_?this.lineDash_.toString():"-")+","+(void 0!==this.lineDashOffset_?this.lineDashOffset_:"-")+","+(void 0!==this.lineJoin_?this.lineJoin_:"-")+","+(void 0!==this.miterLimit_?this.miterLimit_.toString():"-")+","+(void 0!==this.width_?this.width_.toString():"-")),this.checksum_},ht.style.Text=function(t){t=t||{};this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.text_=t.text,this.textAlign_=t.textAlign,this.textBaseline_=t.textBaseline,this.fill_=void 0!==t.fill?t.fill:new ht.style.Fill({color:ht.style.Text.DEFAULT_FILL_COLOR_}),this.stroke_=void 0!==t.stroke?t.stroke:null,this.offsetX_=void 0!==t.offsetX?t.offsetX:0,this.offsetY_=void 0!==t.offsetY?t.offsetY:0},ht.style.Text.DEFAULT_FILL_COLOR_="#333",ht.style.Text.prototype.clone=function(){return new ht.style.Text({font:this.getFont(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:this.getScale(),text:this.getText(),textAlign:this.getTextAlign(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY()})},ht.style.Text.prototype.getFont=function(){return this.font_},ht.style.Text.prototype.getOffsetX=function(){return this.offsetX_},ht.style.Text.prototype.getOffsetY=function(){return this.offsetY_},ht.style.Text.prototype.getFill=function(){return this.fill_},ht.style.Text.prototype.getRotateWithView=function(){return this.rotateWithView_},ht.style.Text.prototype.getRotation=function(){return this.rotation_},ht.style.Text.prototype.getScale=function(){return this.scale_},ht.style.Text.prototype.getStroke=function(){return this.stroke_},ht.style.Text.prototype.getText=function(){return this.text_},ht.style.Text.prototype.getTextAlign=function(){return this.textAlign_},ht.style.Text.prototype.getTextBaseline=function(){return this.textBaseline_},ht.style.Text.prototype.setFont=function(t){this.font_=t},ht.style.Text.prototype.setOffsetX=function(t){this.offsetX_=t},ht.style.Text.prototype.setOffsetY=function(t){this.offsetY_=t},ht.style.Text.prototype.setFill=function(t){this.fill_=t},ht.style.Text.prototype.setRotation=function(t){this.rotation_=t},ht.style.Text.prototype.setScale=function(t){this.scale_=t},ht.style.Text.prototype.setStroke=function(t){this.stroke_=t},ht.style.Text.prototype.setText=function(t){this.text_=t},ht.style.Text.prototype.setTextAlign=function(t){this.textAlign_=t},ht.style.Text.prototype.setTextBaseline=function(t){this.textBaseline_=t},ht.style.Style=function(t){t=t||{};this.geometry_=null,this.geometryFunction_=ht.style.Style.defaultGeometryFunction,void 0!==t.geometry&&this.setGeometry(t.geometry),this.fill_=void 0!==t.fill?t.fill:null,this.image_=void 0!==t.image?t.image:null,this.renderer_=void 0!==t.renderer?t.renderer:null,this.stroke_=void 0!==t.stroke?t.stroke:null,this.text_=void 0!==t.text?t.text:null,this.zIndex_=t.zIndex},ht.style.Style.prototype.clone=function(){var t=this.getGeometry();return t&&t.clone&&(t=t.clone()),new ht.style.Style({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},ht.style.Style.prototype.getRenderer=function(){return this.renderer_},ht.style.Style.prototype.setRenderer=function(t){this.renderer_=t},ht.style.Style.prototype.getGeometry=function(){return this.geometry_},ht.style.Style.prototype.getGeometryFunction=function(){return this.geometryFunction_},ht.style.Style.prototype.getFill=function(){return this.fill_},ht.style.Style.prototype.setFill=function(t){this.fill_=t},ht.style.Style.prototype.getImage=function(){return this.image_},ht.style.Style.prototype.setImage=function(t){this.image_=t},ht.style.Style.prototype.getStroke=function(){return this.stroke_},ht.style.Style.prototype.setStroke=function(t){this.stroke_=t},ht.style.Style.prototype.getText=function(){return this.text_},ht.style.Style.prototype.setText=function(t){this.text_=t},ht.style.Style.prototype.getZIndex=function(){return this.zIndex_},ht.style.Style.prototype.setGeometry=function(e){"function"==typeof e?this.geometryFunction_=e:"string"==typeof e?this.geometryFunction_=function(t){return t.get(e)}:e?void 0!==e&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=ht.style.Style.defaultGeometryFunction,this.geometry_=e},ht.style.Style.prototype.setZIndex=function(t){this.zIndex_=t},ht.style.Style.createFunction=function(t){var e;return"function"==typeof t?t:(e=Array.isArray(t)?t:(ht.asserts.assert(t instanceof ht.style.Style,41),[t]),function(){return e})},ht.style.Style.default_=null,ht.style.Style.defaultFunction=function(t,e){var r,n;return ht.style.Style.default_||(r=new ht.style.Fill({color:"rgba(255,255,255,0.4)"}),n=new ht.style.Stroke({color:"#3399CC",width:1.25}),ht.style.Style.default_=[new ht.style.Style({image:new ht.style.Circle({fill:r,stroke:n,radius:5}),fill:r,stroke:n})]),ht.style.Style.default_},ht.style.Style.createDefaultEditing=function(){var t={},e=[255,255,255,1],r=[0,153,255,1];return t[ht.geom.GeometryType.POLYGON]=[new ht.style.Style({fill:new ht.style.Fill({color:[255,255,255,.5]})})],t[ht.geom.GeometryType.MULTI_POLYGON]=t[ht.geom.GeometryType.POLYGON],t[ht.geom.GeometryType.LINE_STRING]=[new ht.style.Style({stroke:new ht.style.Stroke({color:e,width:5})}),new ht.style.Style({stroke:new ht.style.Stroke({color:r,width:3})})],t[ht.geom.GeometryType.MULTI_LINE_STRING]=t[ht.geom.GeometryType.LINE_STRING],t[ht.geom.GeometryType.CIRCLE]=t[ht.geom.GeometryType.POLYGON].concat(t[ht.geom.GeometryType.LINE_STRING]),t[ht.geom.GeometryType.POINT]=[new ht.style.Style({image:new ht.style.Circle({radius:6,fill:new ht.style.Fill({color:r}),stroke:new ht.style.Stroke({color:e,width:1.5})}),zIndex:1/0})],t[ht.geom.GeometryType.MULTI_POINT]=t[ht.geom.GeometryType.POINT],t[ht.geom.GeometryType.GEOMETRY_COLLECTION]=t[ht.geom.GeometryType.POLYGON].concat(t[ht.geom.GeometryType.LINE_STRING],t[ht.geom.GeometryType.POINT]),t},ht.style.Style.defaultGeometryFunction=function(t){return t.getGeometry()},(ht.format=function(){}).Feature=function(){this.defaultDataProjection=null,this.defaultFeatureProjection=null},ht.format.Feature.prototype.getReadOptions=function(t,e){var r;return e&&(r={dataProjection:e.dataProjection||this.readProjection(t),featureProjection:e.featureProjection}),this.adaptOptions(r)},ht.format.Feature.prototype.adaptOptions=function(t){return ht.obj.assign({dataProjection:this.defaultDataProjection,featureProjection:this.defaultFeatureProjection},t)},ht.format.Feature.prototype.getLastExtent=function(){return null},ht.format.Feature.prototype.getType=function(){},ht.format.Feature.prototype.readFeature=function(t,e){},ht.format.Feature.prototype.readFeatures=function(t,e){},ht.format.Feature.prototype.readGeometry=function(t,e){},ht.format.Feature.prototype.readProjection=function(t){},ht.format.Feature.prototype.writeFeature=function(t,e){},ht.format.Feature.prototype.writeFeatures=function(t,e){},ht.format.Feature.prototype.writeGeometry=function(t,e){},ht.format.Feature.transformWithOptions=function(t,e,r){var n,i=r?ht.proj.get(r.featureProjection):null,o=r?ht.proj.get(r.dataProjection):null,i=i&&o&&!ht.proj.equivalent(i,o)?t instanceof ht.geom.Geometry?(e?t.clone():t).transform(e?i:o,e?o:i):ht.proj.transformExtent(t,o,i):t;return e&&r&&void 0!==r.decimals&&(n=Math.pow(10,r.decimals),i===t&&(i=i.clone()),i.applyTransform(function(t){for(var e=0,r=t.length;e<r;++e)t[e]=Math.round(t[e]*n)/n;return t})),i},ht.format.MVT=function(t){ht.format.Feature.call(this);t=t||{};this.defaultDataProjection=new ht.proj.Projection({code:"",units:ht.proj.Units.TILE_PIXELS}),this.featureClass_=t.featureClass||ht.render.Feature,this.geometryName_=t.geometryName,this.layerName_=t.layerName||"layer",this.layers_=t.layers||null,this.extent_=null},ht.inherits(ht.format.MVT,ht.format.Feature),ht.format.MVT.prototype.getLastExtent=function(){return this.extent_},ht.format.MVT.prototype.getType=function(){return ht.format.FormatType.ARRAY_BUFFER},ht.format.MVT.prototype.readFeature_=function(t,e,r){var n=new this.featureClass_,i=t.id,o=t.properties;o[this.layerName_]=e,this.geometryName_&&n.setGeometryName(this.geometryName_);r=ht.format.Feature.transformWithOptions(ht.format.MVT.readGeometry_(t),!1,this.adaptOptions(r));return n.setGeometry(r),n.setId(i),n.setProperties(o),n},ht.format.MVT.prototype.readRenderFeature_=function(t,e){var r=t.loadGeometry(),n=[],i=[];ht.format.MVT.calculateFlatCoordinates_(r,i,n);var o,s=t.type;1===s?o=1===r.length?ht.geom.GeometryType.POINT:ht.geom.GeometryType.MULTI_POINT:2===s?o=1===r.length?ht.geom.GeometryType.LINE_STRING:ht.geom.GeometryType.MULTI_LINE_STRING:3===s&&(o=ht.geom.GeometryType.POLYGON);s=t.properties;s[this.layerName_]=e;t=t.id;return new this.featureClass_(o,i,n,s,t)},ht.format.MVT.prototype.readFeatures=function(t,e){var r,n=this.layers_,t=new ht.ext.PBF(t),i=new ht.ext.vectortile.VectorTile(t),o=[],s=this.featureClass_;for(r in i.layers)if(!n||-1!=n.indexOf(r)){for(var a,l,h=0,u=(l=i.layers[r]).length;h<u;++h)a=l.feature(h),a=s===ht.render.Feature?this.readRenderFeature_(a,r):this.readFeature_(a,r,e),o.push(a);this.extent_=l?[0,0,l.extent,l.extent]:null}return o},ht.format.MVT.prototype.readProjection=function(t){return this.defaultDataProjection},ht.format.MVT.prototype.setLayers=function(t){this.layers_=t},ht.format.MVT.calculateFlatCoordinates_=function(t,e,r){for(var n=0,i=0,o=t.length;i<o;++i){for(var s=t[i],a=0,l=s.length;a<l;++a){var h=s[a];e.push(h.x,h.y)}n+=2*a,r.push(n)}},ht.format.MVT.readGeometry_=function(t){var e=t.type;if(0===e)return null;var r,n=t.loadGeometry(),i=[],t=[];return ht.format.MVT.calculateFlatCoordinates_(n,t,i),1===e?r=new(1===n.length?ht.geom.Point:ht.geom.MultiPoint)(null):2===e?r=new(1===n.length?ht.geom.LineString:ht.geom.MultiLineString)(null):3===e&&(r=new ht.geom.Polygon(null)),r.setFlatCoordinates(ht.geom.GeometryLayout.XY,t,i),r},ht.format.MVT.prototype.readFeature=function(){},ht.format.MVT.prototype.readGeometry=function(){},ht.format.MVT.prototype.writeFeature=function(){},ht.format.MVT.prototype.writeGeometry=function(){},ht.format.MVT.prototype.writeFeatures=function(){},(ht.renderer=function(){}).vector=function(){},ht.renderer.vector.defaultOrder=function(t,e){return ht.getUid(t)-ht.getUid(e)},ht.renderer.vector.getSquaredTolerance=function(t,e){e=ht.renderer.vector.getTolerance(t,e);return e*e},ht.renderer.vector.getTolerance=function(t,e){return ht.SIMPLIFY_TOLERANCE*t/e},ht.renderer.vector.renderCircleGeometry_=function(t,e,r,n){var i=r.getFill(),o=r.getStroke();(i||o)&&((s=t.getReplay(r.getZIndex(),ht.render.ReplayType.CIRCLE)).setFillStrokeStyle(i,o),s.drawCircle(e,n));var s=r.getText();s&&((r=t.getReplay(r.getZIndex(),ht.render.ReplayType.TEXT)).setTextStyle(s),r.drawText(e.getCenter(),0,2,2,e,n))},ht.renderer.vector.renderFeature=function(t,e,r,n,i,o){var s,a=!1,l=r.getImage();return l&&((s=l.getImageState())==ht.ImageState.LOADED||s==ht.ImageState.ERROR?l.unlistenImageChange(i,o):(s==ht.ImageState.IDLE&&l.load(),s=l.getImageState(),l.listenImageChange(i,o),a=!0)),ht.renderer.vector.renderFeature_(t,e,r,n),a},ht.renderer.vector.renderFeature_=function(t,e,r,n){var i=r.getGeometryFunction()(e);i&&(n=i.getSimplifiedGeometry(n),r.getRenderer()?ht.renderer.vector.renderGeometry_(t,n,r,e):(0,ht.renderer.vector.GEOMETRY_RENDERERS_[n.getType()])(t,n,r,e))},ht.renderer.vector.renderGeometry_=function(t,e,r,n){if(e.getType()!=ht.geom.GeometryType.GEOMETRY_COLLECTION)t.getReplay(r.getZIndex(),ht.render.ReplayType.DEFAULT).drawCustom(e,n,r.getRenderer());else for(var i=e.getGeometries(),o=0,s=i.length;o<s;++o)ht.renderer.vector.renderGeometry_(t,i[o],r,n)},ht.renderer.vector.renderGeometryCollectionGeometry_=function(t,e,r,n){for(var i=e.getGeometriesArray(),o=0,s=i.length;o<s;++o)(0,ht.renderer.vector.GEOMETRY_RENDERERS_[i[o].getType()])(t,i[o],r,n)},ht.renderer.vector.renderLineStringGeometry_=function(t,e,r,n){var i=r.getStroke();i&&((o=t.getReplay(r.getZIndex(),ht.render.ReplayType.LINE_STRING)).setFillStrokeStyle(null,i),o.drawLineString(e,n));var o=r.getText();o&&((r=t.getReplay(r.getZIndex(),ht.render.ReplayType.TEXT)).setTextStyle(o),r.drawText(e.getFlatMidpoint(),0,2,2,e,n))},ht.renderer.vector.renderMultiLineStringGeometry_=function(t,e,r,n){var i=r.getStroke();i&&((o=t.getReplay(r.getZIndex(),ht.render.ReplayType.LINE_STRING)).setFillStrokeStyle(null,i),o.drawMultiLineString(e,n));var o=r.getText();o&&((r=t.getReplay(r.getZIndex(),ht.render.ReplayType.TEXT)).setTextStyle(o),o=e.getFlatMidpoints(),r.drawText(o,0,o.length,2,e,n))},ht.renderer.vector.renderMultiPolygonGeometry_=function(t,e,r,n){var i=r.getFill(),o=r.getStroke();(o||i)&&((s=t.getReplay(r.getZIndex(),ht.render.ReplayType.POLYGON)).setFillStrokeStyle(i,o),s.drawMultiPolygon(e,n));var s=r.getText();s&&((r=t.getReplay(r.getZIndex(),ht.render.ReplayType.TEXT)).setTextStyle(s),s=e.getFlatInteriorPoints(),r.drawText(s,0,s.length,2,e,n))},ht.renderer.vector.renderPointGeometry_=function(t,e,r,n){var i=r.getImage();if(i){if(i.getImageState()!=ht.ImageState.LOADED)return;var o=t.getReplay(r.getZIndex(),ht.render.ReplayType.IMAGE);o.setImageStyle(i),o.drawPoint(e,n)}o=r.getText();o&&((r=t.getReplay(r.getZIndex(),ht.render.ReplayType.TEXT)).setTextStyle(o),r.drawText(e.getFlatCoordinates(),0,2,2,e,n))},ht.renderer.vector.renderMultiPointGeometry_=function(t,e,r,n){var i=r.getImage();if(i){if(i.getImageState()!=ht.ImageState.LOADED)return;var o=t.getReplay(r.getZIndex(),ht.render.ReplayType.IMAGE);o.setImageStyle(i),o.drawMultiPoint(e,n)}o=r.getText();o&&((r=t.getReplay(r.getZIndex(),ht.render.ReplayType.TEXT)).setTextStyle(o),o=e.getFlatCoordinates(),r.drawText(o,0,o.length,e.getStride(),e,n))},ht.renderer.vector.renderPolygonGeometry_=function(t,e,r,n){var i=r.getFill(),o=r.getStroke();(i||o)&&((s=t.getReplay(r.getZIndex(),ht.render.ReplayType.POLYGON)).setFillStrokeStyle(i,o),s.drawPolygon(e,n));var s=r.getText();s&&((r=t.getReplay(r.getZIndex(),ht.render.ReplayType.TEXT)).setTextStyle(s),r.drawText(e.getFlatInteriorPoint(),0,2,2,e,n))},ht.renderer.vector.GEOMETRY_RENDERERS_={Point:ht.renderer.vector.renderPointGeometry_,LineString:ht.renderer.vector.renderLineStringGeometry_,Polygon:ht.renderer.vector.renderPolygonGeometry_,MultiPoint:ht.renderer.vector.renderMultiPointGeometry_,MultiLineString:ht.renderer.vector.renderMultiLineStringGeometry_,MultiPolygon:ht.renderer.vector.renderMultiPolygonGeometry_,GeometryCollection:ht.renderer.vector.renderGeometryCollectionGeometry_,Circle:ht.renderer.vector.renderCircleGeometry_},(ht.render=function(){}).ReplayType={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"},ht.render.replay=function(){},ht.render.replay.ORDER=[ht.render.ReplayType.POLYGON,ht.render.ReplayType.CIRCLE,ht.render.ReplayType.LINE_STRING,ht.render.ReplayType.IMAGE,ht.render.ReplayType.TEXT,ht.render.ReplayType.DEFAULT],ht.render.Feature=function(t,e,r,n,i){this.extent_,this.id_=i,this.type_=t,this.flatCoordinates_=e,this.ends_=r,this.properties_=n},ht.render.Feature.prototype.get=function(t){return this.properties_[t]},ht.render.Feature.prototype.getEnds=function(){return this.ends_},ht.render.Feature.prototype.getExtent=function(){return this.extent_||(this.extent_=this.type_===ht.geom.GeometryType.POINT?ht.extent.createOrUpdateFromCoordinate(this.flatCoordinates_):ht.extent.createOrUpdateFromFlatCoordinates(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_},ht.render.Feature.prototype.getId=function(){return this.id_},ht.render.Feature.prototype.getOrientedFlatCoordinates=function(){return this.flatCoordinates_},ht.render.Feature.prototype.getFlatCoordinates=ht.render.Feature.prototype.getOrientedFlatCoordinates,ht.render.Feature.prototype.getGeometry=function(){return this},ht.render.Feature.prototype.getProperties=function(){return this.properties_},ht.render.Feature.prototype.getSimplifiedGeometry=ht.render.Feature.prototype.getGeometry,ht.render.Feature.prototype.getStride=function(){return 2},ht.render.Feature.prototype.getStyleFunction=ht.nullFunction,ht.render.Feature.prototype.getType=function(){return this.type_},ht.render.ReplayGroup=function(){},ht.render.ReplayGroup.prototype.getReplay=function(t,e){},ht.render.ReplayGroup.prototype.isEmpty=function(){},ht.render.VectorContext=function(){},ht.render.VectorContext.prototype.drawCustom=function(t,e,r){},ht.render.VectorContext.prototype.drawGeometry=function(t){},ht.render.VectorContext.prototype.setStyle=function(t){},ht.render.VectorContext.prototype.drawCircle=function(t,e){},ht.render.VectorContext.prototype.drawFeature=function(t,e){},ht.render.VectorContext.prototype.drawGeometryCollection=function(t,e){},ht.render.VectorContext.prototype.drawLineString=function(t,e){},ht.render.VectorContext.prototype.drawMultiLineString=function(t,e){},ht.render.VectorContext.prototype.drawMultiPoint=function(t,e){},ht.render.VectorContext.prototype.drawMultiPolygon=function(t,e){},ht.render.VectorContext.prototype.drawPoint=function(t,e){},ht.render.VectorContext.prototype.drawPolygon=function(t,e){},ht.render.VectorContext.prototype.drawText=function(t,e,r,n,i,o){},ht.render.VectorContext.prototype.setFillStrokeStyle=function(t,e){},ht.render.VectorContext.prototype.setImageStyle=function(t){},ht.render.VectorContext.prototype.setTextStyle=function(t){},ht.render.canvas=function(){},ht.render.canvas.Instruction={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_IMAGE:5,DRAW_TEXT:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,SET_TEXT_STYLE:12,STROKE:13},ht.render.canvas.defaultFont="10px sans-serif",ht.render.canvas.defaultFillStyle=[0,0,0,1],ht.render.canvas.defaultLineCap="round",ht.render.canvas.defaultLineDash=[],ht.render.canvas.defaultLineDashOffset=0,ht.render.canvas.defaultLineJoin="round",ht.render.canvas.defaultMiterLimit=10,ht.render.canvas.defaultStrokeStyle=[0,0,0,1],ht.render.canvas.defaultTextAlign="center",ht.render.canvas.defaultTextBaseline="middle",ht.render.canvas.defaultLineWidth=1,ht.render.canvas.rotateAtOffset=function(t,e,r,n){0!==e&&(t.translate(r,n),t.rotate(e),t.translate(-r,-n))},ht.render.canvas.Instruction={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_IMAGE:5,DRAW_TEXT:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,SET_TEXT_STYLE:12,STROKE:13},ht.render.canvas.Replay=function(t,e,r,n){ht.render.VectorContext.call(this),this.tolerance=t,this.maxExtent=e,this.overlaps=n,this.maxLineWidth=0,this.resolution=r,this.fillOrigin_,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.instructions=[],this.coordinates=[],this.coordinateCache_={},this.renderedTransform_=ht.transform.create(),this.hitDetectionInstructions=[],this.pixelCoordinates_=null,this.tmpLocalTransform_=ht.transform.create(),this.resetTransform_=ht.transform.create()},ht.inherits(ht.render.canvas.Replay,ht.render.VectorContext),ht.render.canvas.Replay.prototype.appendFlatCoordinates=function(t,e,r,n,i,o){var s=this.coordinates.length,a=this.getBufferedMaxExtent();o&&(e+=n);for(var l,h,u=[t[e],t[e+1]],c=[NaN,NaN],d=!0,f=e+n;f<r;f+=n)c[0]=t[f],c[1]=t[f+1],d=(h=ht.extent.coordinateRelationship(a,c))!==l?(d&&(this.coordinates[s++]=u[0],this.coordinates[s++]=u[1]),this.coordinates[s++]=c[0],this.coordinates[s++]=c[1],!1):h!==ht.extent.Relationship.INTERSECTING||(this.coordinates[s++]=c[0],this.coordinates[s++]=c[1],!1),u[0]=c[0],u[1]=c[1],l=h;return(i&&d||f===e+n)&&(this.coordinates[s++]=u[0],this.coordinates[s++]=u[1]),s},ht.render.canvas.Replay.prototype.drawCustomCoordinates_=function(t,e,r,n,i){for(var o=0,s=r.length;o<s;++o){var a=r[o],l=this.appendFlatCoordinates(t,e,a,n,!1,!1);i.push(l),e=a}return e},ht.render.canvas.Replay.prototype.drawCustom=function(t,e,r){this.beginGeometry(t,e);var n,i,o,s,a=t.getType(),l=t.getStride(),h=this.coordinates.length;if(a==ht.geom.GeometryType.MULTI_POLYGON){n=t.getOrientedFlatCoordinates(),s=[];for(var u=t.getEndss(),c=p=0,d=u.length;c<d;++c){var f=[],p=this.drawCustomCoordinates_(n,p,u[c],l,f);s.push(f)}this.instructions.push([ht.render.canvas.Instruction.CUSTOM,h,s,t,r,ht.geom.flat.inflate.coordinatesss])}else a==ht.geom.GeometryType.POLYGON||a==ht.geom.GeometryType.MULTI_LINE_STRING?(o=[],n=a==ht.geom.GeometryType.POLYGON?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),p=this.drawCustomCoordinates_(n,0,t.getEnds(),l,o),this.instructions.push([ht.render.canvas.Instruction.CUSTOM,h,o,t,r,ht.geom.flat.inflate.coordinatess])):a==ht.geom.GeometryType.LINE_STRING||a==ht.geom.GeometryType.MULTI_POINT?(n=t.getFlatCoordinates(),i=this.appendFlatCoordinates(n,0,n.length,l,!1,!1),this.instructions.push([ht.render.canvas.Instruction.CUSTOM,h,i,t,r,ht.geom.flat.inflate.coordinates])):a==ht.geom.GeometryType.POINT&&(n=t.getFlatCoordinates(),this.coordinates.push(n[0],n[1]),i=this.coordinates.length,this.instructions.push([ht.render.canvas.Instruction.CUSTOM,h,i,t,r]));this.endGeometry(t,e)},ht.render.canvas.Replay.prototype.beginGeometry=function(t,e){this.beginGeometryInstruction1_=[ht.render.canvas.Instruction.BEGIN_GEOMETRY,e,0],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[ht.render.canvas.Instruction.BEGIN_GEOMETRY,e,0],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},ht.render.canvas.Replay.prototype.fill_=function(t,e){var r;this.fillOrigin_&&(r=ht.transform.apply(this.renderedTransform_,this.fillOrigin_.slice()),t.translate(r[0],r[1]),t.rotate(e)),t.fill(),this.fillOrigin_&&t.setTransform.apply(t,this.resetTransform_)},ht.render.canvas.Replay.prototype.replay_=function(t,e,r,n,i,o,s,a){var l;this.pixelCoordinates_&&ht.array.equals(r,this.renderedTransform_)?l=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),l=ht.geom.flat.transform.transform2D(this.coordinates,0,this.coordinates.length,2,r,this.pixelCoordinates_),ht.transform.setFromArray(this.renderedTransform_,r));for(var h,u,c,d,f,p=!ht.obj.isEmpty(i),y=0,g=o.length,_=0,v=this.tmpLocalTransform_,m=this.resetTransform_,x=0,S=0,T=this.coordinateCache_,E={context:t,pixelRatio:e,resolution:this.resolution,rotation:n},R=this.instructions!=o||this.overlaps?0:200;y<g;){var I,L,F=o[y];switch(F[0]){case ht.render.canvas.Instruction.BEGIN_GEOMETRY:I=F[1],p&&i[ht.getUid(I).toString()]||!I.getGeometry()?y=F[2]:void 0===a||ht.extent.intersects(a,I.getGeometry().getExtent())?++y:y=F[2]+1;break;case ht.render.canvas.Instruction.BEGIN_PATH:R<x&&(this.fill_(t,n),x=0),R<S&&(t.stroke(),S=0),x||S||(t.beginPath(),u=c=NaN),++y;break;case ht.render.canvas.Instruction.CIRCLE:var C=l[_=F[1]],w=l[_+1],O=l[_+2]-C,G=l[_+3]-w,G=Math.sqrt(O*O+G*G);t.moveTo(C+G,w),t.arc(C,w,G,0,2*Math.PI,!0),++y;break;case ht.render.canvas.Instruction.CLOSE_PATH:t.closePath(),++y;break;case ht.render.canvas.Instruction.CUSTOM:_=F[1],h=F[2];var M=F[3],k=F[4],G=6==F.length?F[5]:void 0;E.geometry=M,E.feature=I,y in T||(T[y]=[]);M=T[y];G?G(l,_,h,2,M):(M[0]=l[_],M[1]=l[_+1],M.length=2),k(M,E),++y;break;case ht.render.canvas.Instruction.DRAW_IMAGE:_=F[1],h=F[2];var D=F[3],P=F[4]*e,b=F[5]*e,N=F[6],V=F[7],A=F[8],W=F[9],B=F[10],Y=F[11],j=F[12],U=F[13],X=F[14];for(B&&(Y+=n);_<h;_+=2){var J=l[_]-P,H=l[_+1]-b;U&&(J=Math.round(J),H=Math.round(H)),1==j&&0===Y||(K=J+P,q=H+b,ht.transform.compose(v,K,q,j,j,Y,-K,-q),t.setTransform.apply(t,v));var Z=t.globalAlpha;1!=V&&(t.globalAlpha=Z*V);var K=X+A>D.width?D.width-A:X,q=N+W>D.height?D.height-W:N;t.drawImage(D,A,W,K,q,J,H,K*e,q*e),1!=V&&(t.globalAlpha=Z),1==j&&0===Y||t.setTransform.apply(t,m)}++y;break;case ht.render.canvas.Instruction.DRAW_TEXT:_=F[1],h=F[2],L=F[3];var z=F[4]*e,$=F[5]*e,Y=F[6],j=F[7]*e,Q=F[8],tt=F[9];for((B=F[10])&&(Y+=n);_<h;_+=2){J=l[_]+z,H=l[_+1]+$,1==j&&0===Y||(ht.transform.compose(v,J,H,j,j,Y,-J,-H),t.setTransform.apply(t,v));for(var et,rt=L.split("\n"),nt=rt.length,it=1<nt?H-(nt-1)/2*(et=Math.round(1.5*t.measureText("M").width)):(et=0,H),ot=0;ot<nt;ot++){var st=rt[ot];tt&&t.strokeText(st,J,it),Q&&t.fillText(st,J,it),it+=et}1==j&&0===Y||t.setTransform.apply(t,m)}++y;break;case ht.render.canvas.Instruction.END_GEOMETRY:if(void 0!==s){var at=s(I=F[1]);if(at)return at}++y;break;case ht.render.canvas.Instruction.FILL:R?x++:this.fill_(t,n),++y;break;case ht.render.canvas.Instruction.MOVE_TO_LINE_TO:for(_=F[1],h=F[2],J=l[_],f=(H=l[_+1])+.5|0,(d=J+.5|0)===u&&f===c||(t.moveTo(J,H),u=d,c=f),_+=2;_<h;_+=2)d=(J=l[_])+.5|0,f=(H=l[_+1])+.5|0,_!=h-2&&d===u&&f===c||(t.lineTo(J,H),u=d,c=f);++y;break;case ht.render.canvas.Instruction.SET_FILL_STYLE:this.fillOrigin_=F[2],x&&(this.fill_(t,n),x=0,S&&(t.stroke(),S=0)),t.fillStyle=F[1],++y;break;case ht.render.canvas.Instruction.SET_STROKE_STYLE:var k=void 0===F[8]||F[8],lt=F[9],M=F[2];S&&(t.stroke(),S=0),t.strokeStyle=F[1],t.lineWidth=k?M*e:M,t.lineCap=F[3],t.lineJoin=F[4],t.miterLimit=F[5],ht.has.CANVAS_LINE_DASH&&(at=F[6],M=F[7],k&&e!==lt&&(at=at.map(function(t){return t*e/lt}),M*=e/lt,F[6]=at,F[7]=M,F[9]=e),t.lineDashOffset=M,t.setLineDash(at)),++y;break;case ht.render.canvas.Instruction.SET_TEXT_STYLE:t.font=F[1],t.textAlign=F[2],t.textBaseline=F[3],++y;break;case ht.render.canvas.Instruction.STROKE:R?S++:t.stroke(),++y;break;default:++y}}x&&this.fill_(t,n),S&&t.stroke()},ht.render.canvas.Replay.prototype.replay=function(t,e,r,n,i){var o=this.instructions;this.replay_(t,e,r,n,i,o,void 0,void 0)},ht.render.canvas.Replay.prototype.replayHitDetection=function(t,e,r,n,i,o){var s=this.hitDetectionInstructions;return this.replay_(t,1,e,r,n,s,i,o)},ht.render.canvas.Replay.prototype.reverseHitDetectionInstructions=function(){var t=this.hitDetectionInstructions;t.reverse();for(var e,r,n=t.length,i=-1,o=0;o<n;++o)(r=(e=t[o])[0])==ht.render.canvas.Instruction.END_GEOMETRY?i=o:r==ht.render.canvas.Instruction.BEGIN_GEOMETRY&&(e[2]=o,ht.array.reverseSubArray(this.hitDetectionInstructions,i,o),i=-1)},ht.render.canvas.Replay.prototype.endGeometry=function(t,e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;e=[ht.render.canvas.Instruction.END_GEOMETRY,e];this.instructions.push(e),this.hitDetectionInstructions.push(e)},ht.render.canvas.Replay.prototype.finish=ht.nullFunction,ht.render.canvas.Replay.prototype.getBufferedMaxExtent=function(){return this.maxExtent},ht.render.canvas.ImageReplay=function(t,e,r,n){ht.render.canvas.Replay.call(this,t,e,r,n),this.hitDetectionImage_=null,this.image_=null,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.snapToPixel_=void 0,this.width_=void 0},ht.inherits(ht.render.canvas.ImageReplay,ht.render.canvas.Replay),ht.render.canvas.ImageReplay.prototype.drawCoordinates_=function(t,e,r,n){return this.appendFlatCoordinates(t,e,r,n,!1,!1)},ht.render.canvas.ImageReplay.prototype.drawPoint=function(t,e){var r,n,i;this.image_&&(this.beginGeometry(t,e),r=t.getFlatCoordinates(),i=t.getStride(),n=this.coordinates.length,i=this.drawCoordinates_(r,0,r.length,i),this.instructions.push([ht.render.canvas.Instruction.DRAW_IMAGE,n,i,this.image_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.snapToPixel_,this.width_]),this.hitDetectionInstructions.push([ht.render.canvas.Instruction.DRAW_IMAGE,n,i,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.snapToPixel_,this.width_]),this.endGeometry(t,e))},ht.render.canvas.ImageReplay.prototype.drawMultiPoint=function(t,e){var r,n,i;this.image_&&(this.beginGeometry(t,e),r=t.getFlatCoordinates(),i=t.getStride(),n=this.coordinates.length,i=this.drawCoordinates_(r,0,r.length,i),this.instructions.push([ht.render.canvas.Instruction.DRAW_IMAGE,n,i,this.image_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.snapToPixel_,this.width_]),this.hitDetectionInstructions.push([ht.render.canvas.Instruction.DRAW_IMAGE,n,i,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.snapToPixel_,this.width_]),this.endGeometry(t,e))},ht.render.canvas.ImageReplay.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.snapToPixel_=void 0,this.width_=void 0},ht.render.canvas.ImageReplay.prototype.setImageStyle=function(t){var e=t.getAnchor(),r=t.getSize(),n=t.getHitDetectionImage(1),i=t.getImage(1),o=t.getOrigin();this.anchorX_=e[0],this.anchorY_=e[1],this.hitDetectionImage_=n,this.image_=i,this.height_=r[1],this.opacity_=t.getOpacity(),this.originX_=o[0],this.originY_=o[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScale(),this.snapToPixel_=t.getSnapToPixel(),this.width_=r[0]},ht.render.canvas.LineStringReplay=function(t,e,r,n){ht.render.canvas.Replay.call(this,t,e,r,n),this.bufferedMaxExtent_=null,this.state_={currentStrokeStyle:void 0,currentLineCap:void 0,currentLineDash:null,currentLineDashOffset:void 0,currentLineJoin:void 0,currentLineWidth:void 0,currentMiterLimit:void 0,lastStroke:void 0,strokeStyle:void 0,lineCap:void 0,lineDash:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:void 0,miterLimit:void 0}},ht.inherits(ht.render.canvas.LineStringReplay,ht.render.canvas.Replay),ht.render.canvas.LineStringReplay.prototype.drawFlatCoordinates_=function(t,e,r,n){var i=this.coordinates.length,n=this.appendFlatCoordinates(t,e,r,n,!1,!1),n=[ht.render.canvas.Instruction.MOVE_TO_LINE_TO,i,n];return this.instructions.push(n),this.hitDetectionInstructions.push(n),r},ht.render.canvas.LineStringReplay.prototype.getBufferedMaxExtent=function(){var t;return this.bufferedMaxExtent_||(this.bufferedMaxExtent_=ht.extent.clone(this.maxExtent),0<this.maxLineWidth&&(t=this.resolution*(this.maxLineWidth+1)/2,ht.extent.buffer(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_))),this.bufferedMaxExtent_},ht.render.canvas.LineStringReplay.prototype.setStrokeStyle_=function(){var t=this.state_,e=t.strokeStyle,r=t.lineCap,n=t.lineDash,i=t.lineDashOffset,o=t.lineJoin,s=t.lineWidth,a=t.miterLimit;t.currentStrokeStyle==e&&t.currentLineCap==r&&ht.array.equals(t.currentLineDash,n)&&t.currentLineDashOffset==i&&t.currentLineJoin==o&&t.currentLineWidth==s&&t.currentMiterLimit==a||(null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&(this.instructions.push([ht.render.canvas.Instruction.STROKE]),t.lastStroke=this.coordinates.length),t.lastStroke=0,this.instructions.push([ht.render.canvas.Instruction.SET_STROKE_STYLE,e,s,r,o,a,n,i,!0,1],[ht.render.canvas.Instruction.BEGIN_PATH]),t.currentStrokeStyle=e,t.currentLineCap=r,t.currentLineDash=n,t.currentLineDashOffset=i,t.currentLineJoin=o,t.currentLineWidth=s,t.currentMiterLimit=a)},ht.render.canvas.LineStringReplay.prototype.drawLineString=function(t,e){var r=this.state_,n=r.strokeStyle,i=r.lineWidth;void 0!==n&&void 0!==i&&(this.setStrokeStyle_(),this.beginGeometry(t,e),this.hitDetectionInstructions.push([ht.render.canvas.Instruction.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset,!0,1],[ht.render.canvas.Instruction.BEGIN_PATH]),i=t.getFlatCoordinates(),r=t.getStride(),this.drawFlatCoordinates_(i,0,i.length,r),this.hitDetectionInstructions.push([ht.render.canvas.Instruction.STROKE]),this.endGeometry(t,e))},ht.render.canvas.LineStringReplay.prototype.drawMultiLineString=function(t,e){var r=this.state_,n=r.strokeStyle,i=r.lineWidth;if(void 0!==n&&void 0!==i){this.setStrokeStyle_(),this.beginGeometry(t,e),this.hitDetectionInstructions.push([ht.render.canvas.Instruction.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset,!0,1],[ht.render.canvas.Instruction.BEGIN_PATH]);for(var o=t.getEnds(),s=t.getFlatCoordinates(),a=t.getStride(),l=0,h=0,u=o.length;h<u;++h)l=this.drawFlatCoordinates_(s,l,o[h],a);this.hitDetectionInstructions.push([ht.render.canvas.Instruction.STROKE]),this.endGeometry(t,e)}},ht.render.canvas.LineStringReplay.prototype.finish=function(){var t=this.state_;null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&this.instructions.push([ht.render.canvas.Instruction.STROKE]),this.reverseHitDetectionInstructions(),this.state_=null},ht.render.canvas.LineStringReplay.prototype.setFillStrokeStyle=function(t,e){var r=e.getColor();this.state_.strokeStyle=ht.colorlike.asColorLike(r||ht.render.canvas.defaultStrokeStyle);r=e.getLineCap();this.state_.lineCap=void 0!==r?r:ht.render.canvas.defaultLineCap;r=e.getLineDash();this.state_.lineDash=r||ht.render.canvas.defaultLineDash;r=e.getLineDashOffset();this.state_.lineDashOffset=r||ht.render.canvas.defaultLineDashOffset;r=e.getLineJoin();this.state_.lineJoin=void 0!==r?r:ht.render.canvas.defaultLineJoin;r=e.getWidth();this.state_.lineWidth=void 0!==r?r:ht.render.canvas.defaultLineWidth;e=e.getMiterLimit();this.state_.miterLimit=void 0!==e?e:ht.render.canvas.defaultMiterLimit,this.state_.lineWidth>this.maxLineWidth&&(this.maxLineWidth=this.state_.lineWidth,this.bufferedMaxExtent_=null)},ht.render.canvas.PolygonReplay=function(t,e,r,n){ht.render.canvas.Replay.call(this,t,e,r,n),this.bufferedMaxExtent_=null,this.state_={currentFillStyle:void 0,currentStrokeStyle:void 0,currentLineCap:void 0,currentLineDash:null,currentLineDashOffset:void 0,currentLineJoin:void 0,currentLineWidth:void 0,currentMiterLimit:void 0,fillStyle:void 0,strokeStyle:void 0,lineCap:void 0,lineDash:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:void 0,miterLimit:void 0}},ht.inherits(ht.render.canvas.PolygonReplay,ht.render.canvas.Replay),ht.render.canvas.PolygonReplay.prototype.drawFlatCoordinatess_=function(t,e,r,n){var i=this.state_,o=void 0!==i.fillStyle,s=null!=i.strokeStyle,a=r.length,i=[ht.render.canvas.Instruction.BEGIN_PATH];this.instructions.push(i),this.hitDetectionInstructions.push(i);for(var l=0;l<a;++l){var h=r[l],u=this.coordinates.length,c=this.appendFlatCoordinates(t,e,h,n,!0,!s),c=[ht.render.canvas.Instruction.MOVE_TO_LINE_TO,u,c];this.instructions.push(c),this.hitDetectionInstructions.push(c),s&&(c=[ht.render.canvas.Instruction.CLOSE_PATH],this.instructions.push(c),this.hitDetectionInstructions.push(c)),e=h}i=[ht.render.canvas.Instruction.FILL];return this.hitDetectionInstructions.push(i),o&&this.instructions.push(i),s&&(i=[ht.render.canvas.Instruction.STROKE],this.instructions.push(i),this.hitDetectionInstructions.push(i)),e},ht.render.canvas.PolygonReplay.prototype.drawCircle=function(t,e){var r,n=this.state_,i=n.fillStyle,o=n.strokeStyle;void 0===i&&void 0===o||(this.setFillStrokeStyles_(t),this.beginGeometry(t,e),this.hitDetectionInstructions.push([ht.render.canvas.Instruction.SET_FILL_STYLE,ht.color.asString(ht.render.canvas.defaultFillStyle)]),void 0!==n.strokeStyle&&this.hitDetectionInstructions.push([ht.render.canvas.Instruction.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset,!0,1]),r=t.getFlatCoordinates(),i=t.getStride(),o=this.coordinates.length,this.appendFlatCoordinates(r,0,r.length,i,!1,!1),i=[ht.render.canvas.Instruction.BEGIN_PATH],o=[ht.render.canvas.Instruction.CIRCLE,o],this.instructions.push(i,o),this.hitDetectionInstructions.push(i,o),o=[ht.render.canvas.Instruction.FILL],this.hitDetectionInstructions.push(o),void 0!==n.fillStyle&&this.instructions.push(o),void 0!==n.strokeStyle&&(n=[ht.render.canvas.Instruction.STROKE],this.instructions.push(n),this.hitDetectionInstructions.push(n)),this.endGeometry(t,e))},ht.render.canvas.PolygonReplay.prototype.drawPolygon=function(t,e){var r=this.state_;this.setFillStrokeStyles_(t),this.beginGeometry(t,e),this.hitDetectionInstructions.push([ht.render.canvas.Instruction.SET_FILL_STYLE,ht.color.asString(ht.render.canvas.defaultFillStyle)]),void 0!==r.strokeStyle&&this.hitDetectionInstructions.push([ht.render.canvas.Instruction.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset,!0,1]);var n=t.getEnds(),i=t.getOrientedFlatCoordinates(),r=t.getStride();this.drawFlatCoordinatess_(i,0,n,r),this.endGeometry(t,e)},ht.render.canvas.PolygonReplay.prototype.drawMultiPolygon=function(t,e){var r=this.state_,n=r.fillStyle,i=r.strokeStyle;if(void 0!==n||void 0!==i){this.setFillStrokeStyles_(t),this.beginGeometry(t,e),this.hitDetectionInstructions.push([ht.render.canvas.Instruction.SET_FILL_STYLE,ht.color.asString(ht.render.canvas.defaultFillStyle)]),void 0!==r.strokeStyle&&this.hitDetectionInstructions.push([ht.render.canvas.Instruction.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset,!0,1]);for(var o=t.getEndss(),s=t.getOrientedFlatCoordinates(),a=t.getStride(),l=0,h=0,u=o.length;h<u;++h)l=this.drawFlatCoordinatess_(s,l,o[h],a);this.endGeometry(t,e)}},ht.render.canvas.PolygonReplay.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state_=null;var t=this.tolerance;if(0!==t)for(var e=this.coordinates,r=0,n=e.length;r<n;++r)e[r]=ht.geom.flat.simplify.snap(e[r],t)},ht.render.canvas.PolygonReplay.prototype.getBufferedMaxExtent=function(){var t;return this.bufferedMaxExtent_||(this.bufferedMaxExtent_=ht.extent.clone(this.maxExtent),0<this.maxLineWidth&&(t=this.resolution*(this.maxLineWidth+1)/2,ht.extent.buffer(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_))),this.bufferedMaxExtent_},ht.render.canvas.PolygonReplay.prototype.setFillStrokeStyle=function(t,e){var r,n=this.state_;t?(r=t.getColor(),n.fillStyle=ht.colorlike.asColorLike(r||ht.render.canvas.defaultFillStyle)):n.fillStyle=void 0,e?(r=e.getColor(),n.strokeStyle=ht.colorlike.asColorLike(r||ht.render.canvas.defaultStrokeStyle),r=e.getLineCap(),n.lineCap=void 0!==r?r:ht.render.canvas.defaultLineCap,r=e.getLineDash(),n.lineDash=r?r.slice():ht.render.canvas.defaultLineDash,r=e.getLineDashOffset(),n.lineDashOffset=r||ht.render.canvas.defaultLineDashOffset,r=e.getLineJoin(),n.lineJoin=void 0!==r?r:ht.render.canvas.defaultLineJoin,r=e.getWidth(),n.lineWidth=void 0!==r?r:ht.render.canvas.defaultLineWidth,e=e.getMiterLimit(),n.miterLimit=void 0!==e?e:ht.render.canvas.defaultMiterLimit,n.lineWidth>this.maxLineWidth&&(this.maxLineWidth=n.lineWidth,this.bufferedMaxExtent_=null)):(n.strokeStyle=void 0,n.lineCap=void 0,n.lineDash=null,n.lineDashOffset=void 0,n.lineJoin=void 0,n.lineWidth=void 0,n.miterLimit=void 0)},ht.render.canvas.PolygonReplay.prototype.setFillStrokeStyles_=function(t){var e,r=this.state_,n=r.fillStyle,i=r.strokeStyle,o=r.lineCap,s=r.lineDash,a=r.lineDashOffset,l=r.lineJoin,h=r.lineWidth,u=r.miterLimit;void 0===n||"string"==typeof n&&r.currentFillStyle==n||(e=[ht.render.canvas.Instruction.SET_FILL_STYLE,n],"string"!=typeof n&&(t=t.getExtent(),e.push([t[0],t[3]])),this.instructions.push(e),r.currentFillStyle=r.fillStyle),void 0!==i&&(r.currentStrokeStyle==i&&r.currentLineCap==o&&ht.array.equals(r.currentLineDash,s)&&r.currentLineDashOffset==a&&r.currentLineJoin==l&&r.currentLineWidth==h&&r.currentMiterLimit==u||(this.instructions.push([ht.render.canvas.Instruction.SET_STROKE_STYLE,i,h,o,l,u,s,a,!0,1]),r.currentStrokeStyle=i,r.currentLineCap=o,r.currentLineDash=s,r.currentLineDashOffset=a,r.currentLineJoin=l,r.currentLineWidth=h,r.currentMiterLimit=u))},ht.render.canvas.TextReplay=function(t,e,r,n){ht.render.canvas.Replay.call(this,t,e,r,n),this.replayFillState_=null,this.replayStrokeState_=null,this.replayTextState_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textScale_=0,this.textFillState_=null,this.textStrokeState_=null,this.textState_=null},ht.inherits(ht.render.canvas.TextReplay,ht.render.canvas.Replay),ht.render.canvas.TextReplay.prototype.drawText=function(t,e,r,n,i,o){var s;""!==this.text_&&this.textState_&&(this.textFillState_||this.textStrokeState_)&&(this.textFillState_&&this.setReplayFillState_(this.textFillState_),this.textStrokeState_&&this.setReplayStrokeState_(this.textStrokeState_),this.setReplayTextState_(this.textState_),this.beginGeometry(i,o),s=this.coordinates.length,e=this.appendFlatCoordinates(t,e,r,n,!1,!1),r=!!this.textFillState_,n=!!this.textStrokeState_,n=[ht.render.canvas.Instruction.DRAW_TEXT,s,e,this.text_,this.textOffsetX_,this.textOffsetY_,this.textRotation_,this.textScale_,r,n,this.textRotateWithView_],this.instructions.push(n),this.hitDetectionInstructions.push(n),this.endGeometry(i,o))},ht.render.canvas.TextReplay.prototype.setReplayFillState_=function(t){var e,r=this.replayFillState_;r&&r.fillStyle==t.fillStyle||(e=[ht.render.canvas.Instruction.SET_FILL_STYLE,t.fillStyle],this.instructions.push(e),this.hitDetectionInstructions.push(e),r?r.fillStyle=t.fillStyle:this.replayFillState_={fillStyle:t.fillStyle})},ht.render.canvas.TextReplay.prototype.setReplayStrokeState_=function(t){var e,r=this.replayStrokeState_;r&&r.lineCap==t.lineCap&&r.lineDash==t.lineDash&&r.lineDashOffset==t.lineDashOffset&&r.lineJoin==t.lineJoin&&r.lineWidth==t.lineWidth&&r.miterLimit==t.miterLimit&&r.strokeStyle==t.strokeStyle||(e=[ht.render.canvas.Instruction.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth,t.lineCap,t.lineJoin,t.miterLimit,t.lineDash,t.lineDashOffset,!1,1],this.instructions.push(e),this.hitDetectionInstructions.push(e),r?(r.lineCap=t.lineCap,r.lineDash=t.lineDash,r.lineDashOffset=t.lineDashOffset,r.lineJoin=t.lineJoin,r.lineWidth=t.lineWidth,r.miterLimit=t.miterLimit,r.strokeStyle=t.strokeStyle):this.replayStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})},ht.render.canvas.TextReplay.prototype.setReplayTextState_=function(t){var e,r=this.replayTextState_;r&&r.font==t.font&&r.textAlign==t.textAlign&&r.textBaseline==t.textBaseline||(e=[ht.render.canvas.Instruction.SET_TEXT_STYLE,t.font,t.textAlign,t.textBaseline],this.instructions.push(e),this.hitDetectionInstructions.push(e),r?(r.font=t.font,r.textAlign=t.textAlign,r.textBaseline=t.textBaseline):this.replayTextState_={font:t.font,textAlign:t.textAlign,textBaseline:t.textBaseline})},ht.render.canvas.TextReplay.prototype.setTextStyle=function(t){var e,r,n,i,o,s,a,l,h,u,c;t?((e=t.getFill())?(r=e.getColor(),r=ht.colorlike.asColorLike(r||ht.render.canvas.defaultFillStyle),this.textFillState_?this.textFillState_.fillStyle=r:this.textFillState_={fillStyle:r}):this.textFillState_=null,(r=t.getStroke())?(h=r.getColor(),o=r.getLineCap(),s=r.getLineDash(),a=r.getLineDashOffset(),l=r.getLineJoin(),u=r.getWidth(),c=r.getMiterLimit(),i=void 0!==o?o:ht.render.canvas.defaultLineCap,o=s?s.slice():ht.render.canvas.defaultLineDash,s=void 0!==a?a:ht.render.canvas.defaultLineDashOffset,a=void 0!==l?l:ht.render.canvas.defaultLineJoin,l=void 0!==u?u:ht.render.canvas.defaultLineWidth,u=void 0!==c?c:ht.render.canvas.defaultMiterLimit,c=ht.colorlike.asColorLike(h||ht.render.canvas.defaultStrokeStyle),this.textStrokeState_?((n=this.textStrokeState_).lineCap=i,n.lineDash=o,n.lineDashOffset=s,n.lineJoin=a,n.lineWidth=l,n.miterLimit=u,n.strokeStyle=c):this.textStrokeState_={lineCap:i,lineDash:o,lineDashOffset:s,lineJoin:a,lineWidth:l,miterLimit:u,strokeStyle:c}):this.textStrokeState_=null,h=t.getFont(),n=t.getOffsetX(),i=t.getOffsetY(),o=t.getRotateWithView(),s=t.getRotation(),a=t.getScale(),l=t.getText(),u=t.getTextAlign(),c=t.getTextBaseline(),t=void 0!==h?h:ht.render.canvas.defaultFont,h=void 0!==u?u:ht.render.canvas.defaultTextAlign,u=void 0!==c?c:ht.render.canvas.defaultTextBaseline,this.textState_?((c=this.textState_).font=t,c.textAlign=h,c.textBaseline=u):this.textState_={font:t,textAlign:h,textBaseline:u},this.text_=void 0!==l?l:"",this.textOffsetX_=void 0!==n?n:0,this.textOffsetY_=void 0!==i?i:0,this.textRotateWithView_=void 0!==o&&o,this.textRotation_=void 0!==s?s:0,this.textScale_=void 0!==a?a:1):this.text_=""},ht.render.canvas.ReplayGroup=function(t,e,r,n,i){ht.render.ReplayGroup.call(this),this.tolerance_=t,this.maxExtent_=e,this.overlaps_=n,this.resolution_=r,this.renderBuffer_=i,this.replaysByZIndex_={},this.hitDetectionTransform_=ht.transform.create()},ht.inherits(ht.render.canvas.ReplayGroup,ht.render.ReplayGroup),ht.render.canvas.ReplayGroup.circleArrayCache_={0:[[!0]]},ht.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_=function(t,e,r){var n,i=Math.floor(t.length/2);if(i<=e)for(n=i;n<e;n++)t[n][r]=!0;else if(e<i)for(n=e+1;n<i;n++)t[n][r]=!0},ht.render.canvas.ReplayGroup.getCircleArray_=function(t){if(void 0!==ht.render.canvas.ReplayGroup.circleArrayCache_[t])return ht.render.canvas.ReplayGroup.circleArrayCache_[t];for(var e=2*t+1,r=new Array(e),n=0;n<e;n++)r[n]=new Array(e);for(var i=t,o=0,s=0;o<=i;)ht.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(r,t+i,t+o),ht.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(r,t+o,t+i),ht.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(r,t-o,t+i),ht.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(r,t-i,t+o),ht.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(r,t-i,t-o),ht.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(r,t-o,t-i),ht.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(r,t+o,t-i),ht.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(r,t+i,t-o),0<2*((s+=1+2*++o)-i)+1&&(s+=1-2*--i);return ht.render.canvas.ReplayGroup.circleArrayCache_[t]=r},ht.render.canvas.ReplayGroup.prototype.hasReplays=function(t){for(var e in this.replaysByZIndex_)for(var r=this.replaysByZIndex_[e],n=0,i=t.length;n<i;++n)if(t[n]in r)return!0;return!1},ht.render.canvas.ReplayGroup.prototype.finish=function(){for(var t in this.replaysByZIndex_){var e,r=this.replaysByZIndex_[t];for(e in r)r[e].finish()}},ht.render.canvas.ReplayGroup.prototype.forEachFeatureAtCoordinate=function(t,e,r,n,i,o){var s,a=2*(n=Math.round(n))+1,l=ht.transform.compose(this.hitDetectionTransform_,n+.5,n+.5,1/e,-1/e,-r,-t[0],-t[1]),h=this.hitDetectionContext_;h.canvas.width!==a||h.canvas.height!==a?(h.canvas.width=a,h.canvas.height=a):h.clearRect(0,0,a,a),void 0!==this.renderBuffer_&&(s=ht.extent.createEmpty(),ht.extent.extendCoordinate(s,t),ht.extent.buffer(s,e*(this.renderBuffer_+n),s));var u=ht.render.canvas.ReplayGroup.getCircleArray_(n);return this.replayHitDetection_(h,l,r,i,function(t){for(var e=h.getImageData(0,0,a,a).data,r=0;r<a;r++)for(var n=0;n<a;n++)if(u[r][n]&&0<e[4*(n*a+r)+3]){var i=o(t);return i||void h.clearRect(0,0,a,a)}},s)},ht.render.canvas.ReplayGroup.prototype.getClipCoords=function(t){var e=this.maxExtent_,r=e[0],n=e[1],i=e[2],e=e[3],n=[r,n,r,e,i,e,i,n];return ht.geom.flat.transform.transform2D(n,0,8,2,t,n),n},ht.render.canvas.ReplayGroup.prototype.getReplay=function(t,e){var r=void 0!==t?t.toString():"0",t=this.replaysByZIndex_[r];void 0===t&&(t={},this.replaysByZIndex_[r]=t);r=t[e];return void 0===r&&(r=new ht.render.canvas.ReplayGroup.BATCH_CONSTRUCTORS_[e](this.tolerance_,this.maxExtent_,this.resolution_,this.overlaps_),t[e]=r),r},ht.render.canvas.ReplayGroup.prototype.isEmpty=function(){return ht.obj.isEmpty(this.replaysByZIndex_)},ht.render.canvas.ReplayGroup.prototype.replay=function(t,e,r,n,i,o){var s=Object.keys(this.replaysByZIndex_).map(Number);s.sort(ht.array.numberSafeCompareFunction);var a=this.getClipCoords(r);t.save(),t.beginPath(),t.moveTo(a[0],a[1]),t.lineTo(a[2],a[3]),t.lineTo(a[4],a[5]),t.lineTo(a[6],a[7]),t.clip();for(var l,h,u,c,d=o||ht.render.replay.ORDER,f=0,p=s.length;f<p;++f)for(u=this.replaysByZIndex_[s[f].toString()],l=0,h=d.length;l<h;++l)void 0!==(c=u[d[l]])&&c.replay(t,e,r,n,i);t.restore()},ht.render.canvas.ReplayGroup.prototype.replayHitDetection_=function(t,e,r,n,i,o){var s,a,l,h,u,c,d=Object.keys(this.replaysByZIndex_).map(Number);for(d.sort(function(t,e){return e-t}),s=0,a=d.length;s<a;++s)for(h=this.replaysByZIndex_[d[s].toString()],l=ht.render.replay.ORDER.length-1;0<=l;--l)if(u=h[ht.render.replay.ORDER[l]],void 0!==u&&(c=u.replayHitDetection(t,e,r,n,i,o)))return c},ht.render.canvas.ReplayGroup.BATCH_CONSTRUCTORS_={Circle:ht.render.canvas.PolygonReplay,Default:ht.render.canvas.Replay,Image:ht.render.canvas.ImageReplay,LineString:ht.render.canvas.LineStringReplay,Polygon:ht.render.canvas.PolygonReplay,Text:ht.render.canvas.TextReplay},(ht.ext=function(){}).PBF=function(){},function(){!function(t){var e=function(t,e,r,n,i){var o,s,a=8*i-n-1,l=(1<<a)-1,h=l>>1,u=-7,c=r?i-1:0,d=r?-1:1,r=t[e+c];for(c+=d,o=r&(1<<-u)-1,r>>=-u,u+=a;0<u;o=256*o+t[e+c],c+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=n;0<u;s=256*s+t[e+c],c+=d,u-=8);if(0===o)o=1-h;else{if(o===l)return s?NaN:1/0*(r?-1:1);s+=Math.pow(2,n),o-=h}return(r?-1:1)*s*Math.pow(2,o-n)},r=function(t,e,r,n,i,o){var s,a,l=8*o-i-1,h=(1<<l)-1,u=h>>1,c=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,f=n?1:-1,o=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=h):(s=Math.floor(Math.log(e)/Math.LN2),e*(n=Math.pow(2,-s))<1&&(s--,n*=2),2<=(e+=1<=s+u?c/n:c*Math.pow(2,1-u))*n&&(s++,n/=2),h<=s+u?(a=0,s=h):1<=s+u?(a=(e*n-1)*Math.pow(2,i),s+=u):(a=e*Math.pow(2,u-1)*Math.pow(2,i),s=0));8<=i;t[r+d]=255&a,d+=f,a/=256,i-=8);for(s=s<<i|a,l+=i;0<l;t[r+d]=255&s,d+=f,s/=256,l-=8);t[r+d-f]|=128*o},n=i;function i(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var o=4294967296,s=1/o;function a(t){return t.type===i.Bytes?t.readVarint()+t.pos:t.pos+1}function l(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function h(t,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;t<=i;i--)r.buf[i+n]=r.buf[i]}function u(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function c(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function d(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function f(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function p(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function y(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function g(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function _(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function v(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function m(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function x(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function S(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}i.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,o=this.pos;this.type=7&n,t(i,e,this),this.pos===o&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=m(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=S(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=m(this.buf,this.pos)+m(this.buf,this.pos+4)*o;return this.pos+=8,t},readSFixed64:function(){var t=m(this.buf,this.pos)+S(this.buf,this.pos+4)*o;return this.pos+=8,t},readFloat:function(){var t=e(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=e(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,r=e[this.pos++],n=127&r;return r<128?n:(n|=(127&(r=e[this.pos++]))<<7,r<128?n:(n|=(127&(r=e[this.pos++]))<<14,r<128?n:(n|=(127&(r=e[this.pos++]))<<21,r<128?n:function(t,e,r){var n,i,o=r.buf;if(i=o[r.pos++],n=(112&i)>>4,i<128)return l(t,n,e);if(i=o[r.pos++],n|=(127&i)<<3,i<128)return l(t,n,e);if(i=o[r.pos++],n|=(127&i)<<10,i<128)return l(t,n,e);if(i=o[r.pos++],n|=(127&i)<<17,i<128)return l(t,n,e);if(i=o[r.pos++],n|=(127&i)<<24,i<128)return l(t,n,e);if(i=o[r.pos++],n|=(1&i)<<31,i<128)return l(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&e[this.pos])<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=function(t,e,r){var n,i,o,s="",a=e;for(;a<r;){var l=t[a],h=null,u=239<l?4:223<l?3:191<l?2:1;if(r<a+u)break;1===u?l<128&&(h=l):2===u?128==(192&(n=t[a+1]))&&(h=(31&l)<<6|63&n)<=127&&(h=null):3===u?(n=t[a+1],i=t[a+2],128==(192&n)&&128==(192&i)&&((h=(15&l)<<12|(63&n)<<6|63&i)<=2047||55296<=h&&h<=57343)&&(h=null)):4===u&&(n=t[a+1],i=t[a+2],o=t[a+3],128==(192&n)&&128==(192&i)&&128==(192&o)&&((h=(15&l)<<18|(63&n)<<12|(63&i)<<6|63&o)<=65535||1114112<=h)&&(h=null)),null===h?(h=65533,u=1):65535<h&&(h-=65536,s+=String.fromCharCode(h>>>10&1023|55296),h=56320|1023&h),s+=String.fromCharCode(h),a+=u}return s}(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){var r=a(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){t&=7;if(t===i.Varint)for(;127<this.buf[this.pos++];);else if(t===i.Bytes)this.pos=this.readVarint()+this.pos;else if(t===i.Fixed32)this.pos+=4;else{if(t!==i.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e,r=this.length||16;r<this.pos+t;)r*=2;r!==this.length&&((e=new Uint8Array(r)).set(this.buf),this.buf=e,this.length=r)},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),x(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),x(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),x(this.buf,-1&t,this.pos),x(this.buf,Math.floor(t*s),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),x(this.buf,-1&t,this.pos),x(this.buf,Math.floor(t*s),this.pos+4),this.pos+=8},writeVarint:function(t){268435455<(t=+t||0)||t<0?function(t,e){var r,n;if(0<=t?(r=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:n=n+1|(r=0)),0x10000000000000000<=t||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e){e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos]=127&t}(r,e),function(t,e){var r=(7&t)<<4;e.buf[e.pos++]|=r|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(127<t?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(127<t?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(127<t?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var n,i,o=0;o<e.length;o++){if(55295<(n=e.charCodeAt(o))&&n<57344){if(!i){56319<n||o+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):i=n;continue}if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(t[r++]=239,t[r++]=191,t[r++]=189,i=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=63&n|128)}return r}(this.buf,t,this.pos);t=this.pos-e;128<=t&&h(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(t){this.realloc(4),r(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),r(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);e=this.pos-r;128<=e&&h(r,e,this),this.pos=r-1,this.writeVarint(e),this.pos+=e},writeMessage:function(t,e,r){this.writeTag(t,i.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){this.writeMessage(t,u,e)},writePackedSVarint:function(t,e){this.writeMessage(t,c,e)},writePackedBoolean:function(t,e){this.writeMessage(t,p,e)},writePackedFloat:function(t,e){this.writeMessage(t,d,e)},writePackedDouble:function(t,e){this.writeMessage(t,f,e)},writePackedFixed32:function(t,e){this.writeMessage(t,y,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,g,e)},writePackedFixed64:function(t,e){this.writeMessage(t,_,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,v,e)},writeBytesField:function(t,e){this.writeTag(t,i.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,i.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,i.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,i.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}},t.default=n}(this.PBF=this.PBF||{})}.call(ht.ext),ht.ext.PBF=ht.ext.PBF.default,ht.ext.vectortile=function(){},ht.ext.vectortile.VectorTile=function(){},function(){!function(t){var h=e;function e(t,e){this.x=t,this.y=e}e.prototype={clone:function(){return new e(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,t=t.y-this.y;return e*e+t*t},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,t=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=t,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),t=e*this.x-r*this.y,e=r*this.x+e*this.y;return this.x=t,this.y=e,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),t=e.x+r*(this.x-e.x)-n*(this.y-e.y),e=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=t,this.y=e,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},e.convert=function(t){return!(t instanceof e)&&Array.isArray(t)?new e(t[0],t[1]):t};var r=c;function c(t,e,r,n,i){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=i,t.readFields(o,this,e)}function o(t,e,r){1==t?e.id=r.readVarint():2==t?function(t,e){for(var r=t.readVarint()+t.pos;t.pos<r;){var n=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[n]=i}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos)}c.types=["Unknown","Point","LineString","Polygon"],c.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r,n=t.readVarint()+t.pos,i=1,o=0,s=0,a=0,l=[];t.pos<n;)if(o||(i=7&(r=t.readVarint()),o=r>>3),o--,1===i||2===i)s+=t.readSVarint(),a+=t.readSVarint(),1===i&&(e&&l.push(e),e=[]),e.push(new h(s,a));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}return e&&l.push(e),l},c.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,n=1,i=0,o=0,s=0,a=1/0,l=-1/0,h=1/0,u=-1/0;t.pos<r;)if(i||(n=7&(e=t.readVarint()),i=e>>3),i--,1===n||2===n)(o+=t.readSVarint())<a&&(a=o),l<o&&(l=o),(s+=t.readSVarint())<h&&(h=s),u<s&&(u=s);else if(7!==n)throw new Error("unknown command "+n);return[a,h,l,u]},c.prototype.toGeoJSON=function(t,e,r){var n,i=this.extent*Math.pow(2,r),o=this.extent*t,s=this.extent*e,a=this.loadGeometry(),e=c.types[this.type];function l(t){for(var e=0;e<t.length;e++){var r=t[e],n=180-360*(r.y+s)/i;t[e]=[360*(r.x+o)/i-180,360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90]}}switch(this.type){case 1:for(var h=[],u=0;u<a.length;u++)h[u]=a[u][0];l(a=h);break;case 2:for(u=0;u<a.length;u++)l(a[u]);break;case 3:for(a=function(t){var e=t.length;if(e<=1)return[t];for(var r,n,i=[],o=0;o<e;o++){var s=function(t){for(var e,r,n=0,i=0,o=t.length,s=o-1;i<o;s=i++)e=t[i],r=t[s],n+=(r.x-e.x)*(e.y+r.y);return n}(t[o]);0!==s&&(void 0===n&&(n=s<0),n===s<0?(r&&i.push(r),r=[t[o]]):r.push(t[o]))}r&&i.push(r);return i}(a),u=0;u<a.length;u++)for(n=0;n<a[u].length;n++)l(a[u][n])}1===a.length?a=a[0]:e="Multi"+e;e={type:"Feature",geometry:{type:e,coordinates:a},properties:this.properties};return"id"in this&&(e.id=this.id),e};var n=i;function i(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(s,this,e),this.length=this._features.length}function s(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){var e=null,r=t.readVarint()+t.pos;for(;t.pos<r;){var n=t.readVarint()>>3;e=1==n?t.readString():2==n?t.readFloat():3==n?t.readDouble():4==n?t.readVarint64():5==n?t.readVarint():6==n?t.readSVarint():7==n?t.readBoolean():null}return e}(r))}function a(t,e,r){3!==t||(r=new n(r,r.readVarint()+r.pos)).length&&(e[r.name]=r)}function l(t,e){this.layers=t.readFields(a,{},e)}i.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];t=this._pbf.readVarint()+this._pbf.pos;return new r(this._pbf,t,this.extent,this._keys,this._values)};var u=r,d=n,f={VectorTile:l,VectorTileFeature:u,VectorTileLayer:d};t.default=f,t.VectorTile=l,t.VectorTileFeature=u,t.VectorTileLayer=d}(this.vectortile=this.vectortile||{})}.call(ht.ext);var y=new ht.style.Fill({color:""}),g=new ht.style.Stroke({color:"",width:1}),_=new ht.style.Style({fill:y}),v=new ht.style.Style({fill:y,stroke:g}),m=new ht.style.Style({stroke:g}),x=new ht.style.Style({text:new ht.style.Text({text:"",fill:y})}),S=new ht.style.Style({text:new ht.style.Text({text:"",fill:y,stroke:g})}),T={};var E=[];function R(t,e,r,n){var i,o=!1;t.getId()===n?(i=r.styles,o=!0):i=e.styles;for(var s,a=0,l=i.length;a<l&&(s=i[a],p.defined(s.classificationField)&&p.defined(s.classificationFieldValue)&&0!==s.classificationFieldValue.length);++a){var h=t.get(s.classificationField);if(s.classificationFieldValue instanceof Array){if(1===s.classificationFieldValue.length){if(h==s.classificationFieldValue[0])break}else if(h>=s.classificationFieldValue[0]&&h<=s.classificationFieldValue[1])break}else if(h==s.classificationFieldValue)break}var u=0;if(a<l){var r=t.getGeometry().getType();if("Polygon"===r)if(y.setColor(s.color),s.outline){g.setColor(s.outlineColor),g.setWidth(s.lineWidth);for(var c=[],d=0,f=s.lineType.length;d<f;++d)c.push(d%2?s.lineType[d]+s.lineWidth:s.lineType[d]);g.setLineDash(c),E[u++]=v}else E[u++]=_;else if("LineString"===r||"MultiLineString"===r){g.setColor(s.color),g.setWidth(s.lineWidth);for(c=[],d=0,f=s.lineType.length;d<f;++d)c.push(d%2?s.lineType[d]+s.lineWidth:s.lineType[d]);g.setLineDash(c),E[u++]=m}else"Point"===r&&(p.defined(s.icon)&&(E[u++]=(e=s.icon,(r=T[e])||(r=new ht.style.Style({image:new ht.style.Icon({src:"https://unpkg.com/@mapbox/maki@4.0.0/icons/"+e+"-15.svg",imgSize:[15,15],crossOrigin:"anonymous"})}),T[e]=r),r)),p.defined(s.textField)&&(y.setColor(s.color),s.outline?(g.setColor(s.outlineColor),g.setWidth(s.lineWidth),S.getText().setText(t.get(s.textField)),S.getText().setFont(s.font),E[u++]=S):(x.getText().setText(t.get(s.textField)),x.getText().setFont(s.font),E[u++]=x)));for(a=0;a<u;++a)E[a].setZIndex(o?1:0)}return E.length=u,E}return e(function(t,e){for(var r=t.width,n=t.height,i=t.features,o=t.styles,s=t.selectedStyles,a=t.selectedId,l=new OffscreenCanvas(r,n),h=l.getContext("2d"),u=i.rect||[0,0,4096,4096],c=new ht.render.canvas.ReplayGroup(0,u,8,!0,100),d=0,f=i.length;d<f;++d)for(var p=i[d],y=new ht.render.Feature(p.type_,p.flatCoordinates_,p.ends_,p.properties_,p.id_),g=R(y,o,s,a),_=0,v=g.length;_<v;++_)ht.renderer.vector.renderFeature_(c,y,g[_],16);return c.finish(),h.scale(1,-1),h.translate(0,-n),u=[r/(u[2]-u[0]),0,0,n/(u[3]-u[1]),-r*u[0]/(u[2]-u[0]),-n*u[1]/(u[3]-u[1])],c.replay(h,1,u,0,{},["Default","Image","Polygon","LineString","Text"]),{data:l.transferToImageBitmap(),time:t.time}})});
