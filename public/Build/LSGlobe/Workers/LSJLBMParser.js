define(["./LSJBinModelNode"],function(R){"use strict";function d(){this.imgUrl="",this.imgBlob=null,this.bUrl=!0,this.bTransparent=!1,this.thumbImg=null}function s(){this.imgIndex=-1,this.renderMode=1}function l(){this.id=-1,this.index=-1,this.ambient=[],this.diffuse=[],this.specular=[],this.emission=[],this.shininess=0,this.imgUnits=[]}function L(){this.texIndex=0,this.texCoordIndex=0}function J(){this.matIndex=-1,this.primitiveType=0,this.opType=0,this.indices=null,this.texUnits=[]}function O(){this.matIndex=-1,this.verts=null,this.normals=null,this.colors=null,this.colorPerNum=1,this.secondColors=null,this.secondColorPerNum=1,this.indices=null,this.uvs=[],this.texUnits=[],this.primitiveSets=[]}var n=1,k={BDT_Undefined:0,BDT_Byte:1,BDT_Short:2,BDT_Int:3,BDT_UByte:4,BDT_UShort:5,BDT_UInt:6,BDT_Float:7,BDT_Double:8};function r(){}return r.prototype.parseSimpleMaterial=function(r,e,a){var t=new l;t.index=a,t.id=a,r.arryMaterials.push(t),t.ambient=e.readUChar8Array2(4),t.diffuse=e.readUChar8Array2(4),t.specular=e.readUChar8Array2(4),t.emission=e.readUChar8Array2(4),t.shininess=e.readFloat();for(var n=e.readUInt32(),i=0;i<n;i++){var o=new s;e.readUChar8();o.imgIndex=e.readUInt32(),o.renderMode=e.readUInt32(),t.imgUnits.push(o)}},r.prototype.parseBinImgInnerData=function(r,e){var a,t=e.readString(),n=e.readUInt32();n<1||(n=e.readUChar8Array2(n),".jpeg"==(t=t.substring(t.lastIndexOf("."),t.length).toLowerCase())||".jpg"==t?a="jpeg":".png"==t?a="png":".gif"==t?a="gif":".icon"==t&&(a="x-icon"),r.imgBlob=new Blob([n],{type:a}),r.bUrl=!1)},r.prototype.parseImages=function(r,e){for(var a=e.readUInt32(),t=0;t<a;t++){var n,i=new d,o=e.readUInt32(),s=e.readUChar8();0==o?this.parseBinImgInnerData(i,e):(n=e.readString(),i.imgUrl=n,i.bUrl=!0),i.bTransparent=s,r.arryImages.push(i),e.readUChar8()&&(n=new d,this.parseBinImgInnerData(n,e),n.bTransparent=s,i.thumbImg=n)}},r.prototype.parseMaterials=function(r,e){for(var a=e.readUInt32(),t=0;t<a;t++)e.readUInt32()==n&&this.parseSimpleMaterial(r,e,t)},r.prototype.parseNode=function(r,e){for(var a=e.readUInt32(),t=0;t<a;t++){var n=e.readUInt32(),i=new R;r.children.push(i),0==n?i.strDataPath=e.readString():this.parseNode(i,e)}r.enRangeMode=e.readUInt32();var o=e.readUInt32(),t=0,s=0;for(t=0;t<o;t++)r.childRanges.push(e.readDouble()),r.childRanges.push(e.readDouble());r.bdSphere.push(e.readDouble()),r.bdSphere.push(e.readDouble()),r.bdSphere.push(e.readDouble()),r.bdSphere.push(e.readDouble()),r.bdBox.push(e.readDouble()),r.bdBox.push(e.readDouble()),r.bdBox.push(e.readDouble()),r.bdBox.push(e.readDouble()),r.bdBox.push(e.readDouble()),r.bdBox.push(e.readDouble());var d=e.readUInt32();for(t=0;t<d;t++){var l=new O;r.nodeMeshes.push(l),l.matIndex=e.readUInt32();var h=e.readUInt32();if(0<h)if((M=e.readUInt32())==k.BDT_Float){var U=e.readFloat32Array(h);for(l.verts=new Float32Array(h),s=0;s<h;s++)l.verts[s]=U.getFloat32(4*s,!0)}if(h=e.readUInt32(),0<h)if((M=e.readUInt32())==k.BDT_Float){var u=e.readFloat32Array(h);for(l.normals=new Float32Array(h),s=0;s<h;s++)l.normals[s]=u.getFloat32(4*s,!0)}if(h=e.readUInt32(),0<h)if((M=e.readUInt32())==k.BDT_UInt){var I=e.readUInt32Array(h);for(l.colors=new Float32Array(3*h),l.colorPerNum=3,s=0;s<h;s++){var p=(c=I.getUint32(4*s,!0))>>16&255,f=c>>8&255,b=255&c;l.colors[3*s]=p/255,l.colors[3*s+1]=f/255,l.colors[3*s+2]=b/255}}if(h=e.readUInt32(),0<h)if((M=e.readUInt32())==k.BDT_UInt){I=e.readUInt32Array(h);for(l.secondColors=new Float32Array(3*h),l.secondColorPerNum=3,s=0;s<h;s++){var c,p=(c=I.getUint32(4*s,!0))>>16&255,f=c>>8&255,b=255&c;l.secondColors[3*s]=p/255,l.secondColors[3*s+1]=f/255,l.secondColors[3*s+2]=b/255}}var D=e.readUInt32();if(0<D){var g=e.readUInt32();if(g==k.BDT_UInt){var v=e.readUInt32Array(D);for(l.indices=new Uint32Array(D),s=0;s<D;s++)l.indices[s]=v.getUint32(4*s,!0)}else if(g==k.BDT_UShort){v=e.readUInt16Array(D);for(l.indices=new Uint16Array(D),s=0;s<D;s++)l.indices[s]=v.getUint16(2*s,!0)}}for(var m=e.readUInt32(),y=0;y<m;y++){var B=e.readUInt32();if(0<B)if((M=e.readUInt32())==k.BDT_Float){for(var x=e.readFloat32Array(B),T=new Float32Array(B),s=0;s<B;s++)T[s]=x.getFloat32(4*s,!0);l.uvs.push(T)}}for(var A=e.readUInt32(),w=0;w<A;w++){var C=new L;l.texUnits.push(C),C.texIndex=e.readUInt32(),C.texCoordIndex=e.readUInt32()}for(var _=e.readUInt32(),F=0;F<_;F++){var S=new J;l.primitiveSets.push(S),S.primitiveType=e.readUInt32(),S.opType=e.readUInt32(),S.matIndex=e.readUInt32();var M,N=e.readUInt32();if(0<N)if((M=e.readUInt32())==k.BDT_Uint){v=e.readUInt32Array(N);for(S.indices=new Uint32Array(N),s=0;s<N;s++)S.indices[s]=v.getUint32(4*s,!0)}else if(M==k.BDT_UShort){v=e.readUInt16Array(N);for(S.indices=new Uint16Array(N),s=0;s<N;s++)S.indices[s]=v.getUint16(2*s,!0)}for(var P=e.readUInt32(),j=0;j<P;j++){C=new L;S.texUnits.push(C),C.texIndex=e.readUInt32(),C.texCoordIndex=e.readUInt32()}}}},r.prototype.parse=function(r,e){e.readUInt32(),e.readUInt32(),e.readUInt32(),e.readDouble(),e.readDouble(),e.readDouble(),e.readDouble(),e.readDouble(),e.readDouble(),e.readDouble(),e.readDouble(),e.readDouble();this.parseImages(r,e),this.parseMaterials(r,e),this.parseNode(r,e)},r});
