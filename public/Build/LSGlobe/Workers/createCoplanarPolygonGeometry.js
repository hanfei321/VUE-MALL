define(["./defaultValue-bcb5baf7","./DeveloperError-b273b01a","./Check-f9a1a1be","./Math-588d98f6","./Cartesian2-10213add","./Rectangle-de996bfb","./Transforms-2b063051","./Matrix4-c981b715","./RuntimeError-1b5fbc4d","./WebGLConstants-667a4a5e","./ComponentDatatype-ec1abf38","./GeometryAttribute-49fe2445","./when-ae2a7552","./buildModuleUrl-cd6b3599","./GeometryAttributes-a8cf4ac9","./AttributeCompression-8a5fa32d","./GeometryPipeline-635df242","./EncodedCartesian3-96cc4460","./IndexDatatype-523f50d6","./IntersectionTests-cc1722b0","./Plane-bb97f210","./VertexFormat-15410d3c","./GeometryInstance-9c4aba48","./arrayRemoveDuplicates-f05ed775","./BoundingRectangle-7fd61f33","./EllipsoidTangentPlane-86347fa6","./OrientedBoundingBox-6de788ea","./CoplanarPolygonGeometryLibrary-a109caa1","./ArcType-90391c26","./EllipsoidRhumbLine-b25fd372","./PolygonPipeline-bd17f470","./PolygonGeometryLibrary-a80bacff"],function(l,e,t,L,E,s,T,D,a,n,V,_,r,o,k,i,f,p,R,c,y,u,h,v,m,d,g,C,b,x,M,P){"use strict";var I=new E.Cartesian3,w=new m.BoundingRectangle,H=new E.Cartesian2,B=new E.Cartesian2,A=new E.Cartesian3,F=new E.Cartesian3,G=new E.Cartesian3,O=new E.Cartesian3,z=new E.Cartesian3,S=new E.Cartesian3,N=new T.Quaternion,Q=new D.Matrix3,U=new D.Matrix3,j=new E.Cartesian3;function Y(e){var t=(e=l.defaultValue(e,l.defaultValue.EMPTY_OBJECT)).polygonHierarchy,a=l.defaultValue(e.vertexFormat,u.VertexFormat.DEFAULT);this._vertexFormat=u.VertexFormat.clone(a),this._polygonHierarchy=t,this._stRotation=l.defaultValue(e.stRotation,0),this._ellipsoid=s.Ellipsoid.clone(l.defaultValue(e.ellipsoid,s.Ellipsoid.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=P.PolygonGeometryLibrary.computeHierarchyPackedLength(t)+u.VertexFormat.packedLength+s.Ellipsoid.packedLength+2}Y.fromPositions=function(e){return new Y({polygonHierarchy:{positions:(e=l.defaultValue(e,l.defaultValue.EMPTY_OBJECT)).positions},vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid})},Y.pack=function(e,t,a){return a=l.defaultValue(a,0),a=P.PolygonGeometryLibrary.packPolygonHierarchy(e._polygonHierarchy,t,a),s.Ellipsoid.pack(e._ellipsoid,t,a),a+=s.Ellipsoid.packedLength,u.VertexFormat.pack(e._vertexFormat,t,a),a+=u.VertexFormat.packedLength,t[a++]=e._stRotation,t[a]=e.packedLength,t};var q=s.Ellipsoid.clone(s.Ellipsoid.UNIT_SPHERE),J=new u.VertexFormat,W={polygonHierarchy:{}};return Y.unpack=function(e,t,a){t=l.defaultValue(t,0);var n=P.PolygonGeometryLibrary.unpackPolygonHierarchy(e,t);t=n.startingIndex,delete n.startingIndex;var r=s.Ellipsoid.unpack(e,t,q);t+=s.Ellipsoid.packedLength;var o=u.VertexFormat.unpack(e,t,J);t+=u.VertexFormat.packedLength;var i=e[t++],t=e[t];return l.defined(a)||(a=new Y(W)),a._polygonHierarchy=n,a._ellipsoid=s.Ellipsoid.clone(r,a._ellipsoid),a._vertexFormat=u.VertexFormat.clone(o,a._vertexFormat),a._stRotation=i,a.packedLength=t,a},Y.createGeometry=function(e){var t=e._vertexFormat,a=e._polygonHierarchy,n=e._stRotation,r=a.positions;if(!((r=v.arrayRemoveDuplicates(r,E.Cartesian3.equalsEpsilon,!0)).length<3)){var o=A,i=F,l=G,s=z,p=S;if(C.CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(r,O,s,p)){o=E.Cartesian3.cross(s,p,o);o=E.Cartesian3.normalize(o,o),E.Cartesian3.equalsEpsilon(O,E.Cartesian3.ZERO,L.CesiumMath.EPSILON6)||(c=e._ellipsoid.geodeticSurfaceNormal(O,j),E.Cartesian3.dot(o,c)<0&&(o=E.Cartesian3.negate(o,o),s=E.Cartesian3.negate(s,s)));var c=C.CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(O,s,p),y=C.CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(O,s,p);t.tangent&&(i=E.Cartesian3.clone(s,i)),t.bitangent&&(l=E.Cartesian3.clone(p,l));var a=P.PolygonGeometryLibrary.polygonsFromHierarchy(a,c,!1),c=a.hierarchy,u=a.polygons;if(0!==c.length){r=c[0].outerRing;for(var a=T.BoundingSphere.fromPoints(r),m=P.PolygonGeometryLibrary.computeBoundingRectangle(o,y,r,n,w),d=[],g=0;g<u.length;g++){var b=new h.GeometryInstance({geometry:function(e,t,a,n,r,o,i,l){var s=e.positions,p=M.PolygonPipeline.triangulate(e.positions2D,e.holes);p.length<3&&(p=[0,1,2]),(e=R.IndexDatatype.createTypedArray(s.length,p.length)).set(p);var c=Q;0!==n?(p=T.Quaternion.fromAxisAngle(o,n,N),c=D.Matrix3.fromQuaternion(p,c),(t.tangent||t.bitangent)&&(p=T.Quaternion.fromAxisAngle(o,-n,N),m=D.Matrix3.fromQuaternion(p,U),i=E.Cartesian3.normalize(D.Matrix3.multiplyByVector(m,i,i),i),t.bitangent&&(l=E.Cartesian3.normalize(E.Cartesian3.cross(o,i,l),l)))):c=D.Matrix3.clone(D.Matrix3.IDENTITY,c);var y=B;t.st&&(y.x=a.x,y.y=a.y);for(var u=s.length,m=3*u,d=new Float64Array(m),g=t.normal?new Float32Array(m):void 0,b=t.tangent?new Float32Array(m):void 0,f=t.bitangent?new Float32Array(m):void 0,h=t.st?new Float32Array(2*u):void 0,v=0,C=0,x=0,P=0,w=0,A=0;A<u;A++){var F,G=s[A];d[v++]=G.x,d[v++]=G.y,d[v++]=G.z,t.st&&(F=r(D.Matrix3.multiplyByVector(c,G,I),H),E.Cartesian2.subtract(F,y,F),G=L.CesiumMath.clamp(F.x/a.width,0,1),F=L.CesiumMath.clamp(F.y/a.height,0,1),h[w++]=G,h[w++]=F),t.normal&&(g[C++]=o.x,g[C++]=o.y,g[C++]=o.z),t.tangent&&(b[P++]=i.x,b[P++]=i.y,b[P++]=i.z),t.bitangent&&(f[x++]=l.x,f[x++]=l.y,f[x++]=l.z)}return m=new k.GeometryAttributes,t.position&&(m.position=new _.GeometryAttribute({componentDatatype:V.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:d})),t.normal&&(m.normal=new _.GeometryAttribute({componentDatatype:V.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:g})),t.tangent&&(m.tangent=new _.GeometryAttribute({componentDatatype:V.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:b})),t.bitangent&&(m.bitangent=new _.GeometryAttribute({componentDatatype:V.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:f})),t.st&&(m.st=new _.GeometryAttribute({componentDatatype:V.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:h})),new _.Geometry({attributes:m,indices:e,primitiveType:_.PrimitiveType.TRIANGLES})}(u[g],t,m,n,y,o,i,l)});d.push(b)}c=f.GeometryPipeline.combineInstances(d)[0];c.attributes.position.values=new Float64Array(c.attributes.position.values),c.indices=R.IndexDatatype.createTypedArray(c.attributes.position.values.length/3,c.indices);r=c.attributes;return t.position||delete r.position,new _.Geometry({attributes:r,indices:c.indices,primitiveType:c.primitiveType,boundingSphere:a})}}}},function(e,t){return l.defined(t)&&(e=Y.unpack(e,t)),Y.createGeometry(e)}});
