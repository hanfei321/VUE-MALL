define(["./defaultValue-bcb5baf7","./DeveloperError-b273b01a","./Check-f9a1a1be","./Math-588d98f6","./Cartesian2-10213add","./Rectangle-de996bfb","./Transforms-2b063051","./Matrix4-c981b715","./RuntimeError-1b5fbc4d","./WebGLConstants-667a4a5e","./ComponentDatatype-ec1abf38","./when-ae2a7552","./buildModuleUrl-cd6b3599","./AttributeCompression-8a5fa32d","./IndexDatatype-523f50d6","./IntersectionTests-cc1722b0","./Plane-bb97f210","./createTaskProcessorWorker","./EllipsoidTangentPlane-86347fa6","./OrientedBoundingBox-6de788ea","./TerrainEncoding-a5a06c70"],function(g,e,t,oe,ae,de,pe,i,n,s,r,h,u,o,le,a,d,p,l,fe,ce){"use strict";var ge={clipTriangleAtAxisAlignedThreshold:function(e,t,i,n,s,r){var h,u,o;g.defined(r)?r.length=0:r=[],o=t?(h=i<e,u=n<e,s<e):(h=e<i,u=e<n,e<s);var a,d,p,l,f,c,t=h+u+o;return 1===t?h?(a=(e-i)/(n-i),d=(e-i)/(s-i),r.push(1),r.push(2),1!==d&&(r.push(-1),r.push(0),r.push(2),r.push(d)),1!==a&&(r.push(-1),r.push(0),r.push(1),r.push(a))):u?(p=(e-n)/(s-n),l=(e-n)/(i-n),r.push(2),r.push(0),1!==l&&(r.push(-1),r.push(1),r.push(0),r.push(l)),1!==p&&(r.push(-1),r.push(1),r.push(2),r.push(p))):o&&(f=(e-s)/(i-s),c=(e-s)/(n-s),r.push(0),r.push(1),1!==c&&(r.push(-1),r.push(2),r.push(1),r.push(c)),1!==f&&(r.push(-1),r.push(2),r.push(0),r.push(f))):2===t?h||i===e?u||n===e?o||s===e||(d=(e-i)/(s-i),p=(e-n)/(s-n),r.push(2),r.push(-1),r.push(0),r.push(2),r.push(d),r.push(-1),r.push(1),r.push(2),r.push(p)):(c=(e-s)/(n-s),a=(e-i)/(n-i),r.push(1),r.push(-1),r.push(2),r.push(1),r.push(c),r.push(-1),r.push(0),r.push(1),r.push(a)):(l=(e-n)/(i-n),f=(e-s)/(i-s),r.push(0),r.push(-1),r.push(1),r.push(0),r.push(l),r.push(-1),r.push(2),r.push(0),r.push(f)):3!==t&&(r.push(0),r.push(1),r.push(2)),r},computeBarycentricCoordinates:function(e,t,i,n,s,r,h,u,o){var a=i-h,i=h-s,s=r-u,r=n-u,n=1/(s*a+i*r),u=t-u,h=e-h,i=(s*h+i*u)*n,u=(-r*h+a*u)*n,n=1-i-u;return g.defined(o)?(o.x=i,o.y=u,o.z=n,o):new ae.Cartesian3(i,u,n)},computeLineSegmentLineSegmentIntersection:function(e,t,i,n,s,r,h,u,o){var a=(h-s)*(t-r)-(u-r)*(e-s),d=(i-e)*(t-r)-(n-t)*(e-s),s=(u-r)*(i-e)-(h-s)*(n-t);if(0!=s){a=a/s,s=d/s;return 0<=a&&a<=1&&0<=s&&s<=1?(g.defined(o)||(o=new ae.Cartesian2),o.x=e+a*(i-e),o.y=t+a*(n-t),o):void 0}}},me=32767,xe=16383,ve=[],we=[],Ce=[],be=new ae.Cartographic,ye=new ae.Cartesian3,Be=[],Ie=[],Ae=[],Te=[],Me=[],ze=new ae.Cartesian3,Ve=new pe.BoundingSphere,Ne=new fe.OrientedBoundingBox,Ee=new ae.Cartesian2,Re=new ae.Cartesian3;function He(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}He.prototype.clone=function(e){return g.defined(e)||(e=new He),e.uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},He.prototype.initializeIndexed=function(e,t,i,n,s){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=s,this.first=void 0,this.second=void 0,this.ratio=void 0},He.prototype.initializeFromClipResult=function(e,t,i){var n=t+1;return-1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],++n,this.second=i[e[n]],++n,this.ratio=e[n],++n),n},He.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},He.prototype.isIndexed=function(){return g.defined(this.index)},He.prototype.getH=function(){return g.defined(this.index)?this.heightBuffer[this.index]:oe.CesiumMath.lerp(this.first.getH(),this.second.getH(),this.ratio)},He.prototype.getU=function(){return g.defined(this.index)?this.uBuffer[this.index]:oe.CesiumMath.lerp(this.first.getU(),this.second.getU(),this.ratio)},He.prototype.getV=function(){return g.defined(this.index)?this.vBuffer[this.index]:oe.CesiumMath.lerp(this.first.getV(),this.second.getV(),this.ratio)};var f=new ae.Cartesian2,c=-1,m=[new ae.Cartesian3,new ae.Cartesian3],x=[new ae.Cartesian3,new ae.Cartesian3];function v(e,t){var i=m[++c],n=x[c],i=o.AttributeCompression.octDecode(e.first.getNormalX(),e.first.getNormalY(),i),n=o.AttributeCompression.octDecode(e.second.getNormalX(),e.second.getNormalY(),n);return ye=ae.Cartesian3.lerp(i,n,e.ratio,ye),ae.Cartesian3.normalize(ye,ye),o.AttributeCompression.octEncode(ye,t),--c,t}He.prototype.getNormalX=function(){return g.defined(this.index)?this.normalBuffer[2*this.index]:(f=v(this,f)).x},He.prototype.getNormalY=function(){return g.defined(this.index)?this.normalBuffer[2*this.index+1]:(f=v(this,f)).y};var w=[];function Oe(e,t,i,n,s,r,h,u,o){if(0!==h.length){for(var a=0,d=0;d<h.length;)d=w[a++].initializeFromClipResult(h,d,u);for(var p=0;p<a;++p){var l,f,c=w[p];c.isIndexed()?(c.newIndex=r[c.index],c.uBuffer=e,c.vBuffer=t,c.heightBuffer=i,o&&(c.normalBuffer=n)):(l=c.getKey(),g.defined(r[l])?c.newIndex=r[l]:(f=e.length,e.push(c.getU()),t.push(c.getV()),i.push(c.getH()),o&&(n.push(c.getNormalX()),n.push(c.getNormalY())),c.newIndex=f,r[l]=f))}3===a?(s.push(w[0].newIndex),s.push(w[1].newIndex),s.push(w[2].newIndex)):4===a&&(s.push(w[0].newIndex),s.push(w[1].newIndex),s.push(w[2].newIndex),s.push(w[0].newIndex),s.push(w[2].newIndex),s.push(w[3].newIndex))}}return w.push(new He),w.push(new He),w.push(new He),w.push(new He),p(function(e,t){var i=e.isEastChild,n=e.isNorthChild,s=i?xe:0,r=i?me:xe,h=n?xe:0,u=n?me:xe,o=Be,a=Ie,d=Ae,p=Me;o.length=0,a.length=0,d.length=0,p.length=0;var l=Te;l.length=0;for(var f={},c=e.vertices,g=(g=e.indices).subarray(0,e.indexCountWithoutSkirts),m=ce.TerrainEncoding.clone(e.encoding),x=m.hasVertexNormals,v=e.exaggeration,w=0,C=e.vertexCountWithoutSkirts,b=e.minimumHeight,y=e.maximumHeight,B=new Array(C),I=new Array(C),A=new Array(C),T=x?new Array(2*C):void 0,M=0,z=0;M<C;++M,z+=2){var V=m.decodeTextureCoordinates(c,M,Ee),N=m.decodeHeight(c,M)/v,E=oe.CesiumMath.clamp(V.x*me|0,0,me),R=oe.CesiumMath.clamp(V.y*me|0,0,me);A[M]=oe.CesiumMath.clamp((N-b)/(y-b)*me|0,0,me),E<20&&(E=0),R<20&&(R=0),me-E<20&&(E=me),me-R<20&&(R=me),B[M]=E,I[M]=R,x&&(V=m.getOctEncodedNormal(c,M,Re),T[z]=V.x,T[z+1]=V.y),(i&&xe<=E||!i&&E<=xe)&&(n&&xe<=R||!n&&R<=xe)&&(f[M]=w,o.push(E),a.push(R),d.push(A[M]),x&&(p.push(T[z]),p.push(T[z+1])),++w)}var H=[];H.push(new He),H.push(new He),H.push(new He);var O=[];for(O.push(new He),O.push(new He),O.push(new He),M=0;M<g.length;M+=3){var U=g[M],S=g[M+1],F=g[M+2],P=B[U],D=B[S],k=B[F];H[0].initializeIndexed(B,I,A,T,U),H[1].initializeIndexed(B,I,A,T,S),H[2].initializeIndexed(B,I,A,T,F);D=ge.clipTriangleAtAxisAlignedThreshold(xe,i,P,D,k,ve);D.length<=0||(k=O[0].initializeFromClipResult(D,0,H))>=D.length||(k=O[1].initializeFromClipResult(D,k,H))>=D.length||(k=O[2].initializeFromClipResult(D,k,H),Oe(o,a,d,p,l,f,ge.clipTriangleAtAxisAlignedThreshold(xe,n,O[0].getV(),O[1].getV(),O[2].getV(),we),O,x),k<D.length&&(O[2].clone(O[1]),O[2].initializeFromClipResult(D,k,H),Oe(o,a,d,p,l,f,ge.clipTriangleAtAxisAlignedThreshold(xe,n,O[0].getV(),O[1].getV(),O[2].getV(),we),O,x)))}var W=i?-me:0,X=n?-me:0,K=[],L=[],Y=[],_=[],G=Number.MAX_VALUE,J=-G,Z=Ce;Z.length=0;var j=de.Ellipsoid.clone(e.ellipsoid),q=(ue=de.Rectangle.clone(e.childRectangle)).north,Q=ue.south,$=ue.east,ee=ue.west;for($<ee&&($+=oe.CesiumMath.TWO_PI),M=0;M<o.length;++M)E=(E=Math.round(o[M]))<=s?(K.push(M),0):r<=E?(Y.push(M),me):2*E+W,o[M]=E,R=(R=Math.round(a[M]))<=h?(L.push(M),0):u<=R?(_.push(M),me):2*R+X,a[M]=R,(N=oe.CesiumMath.lerp(b,y,d[M]/me))<G&&(G=N),J<N&&(J=N),d[M]=N,be.longitude=oe.CesiumMath.lerp(ee,$,E/me),be.latitude=oe.CesiumMath.lerp(Q,q,R/me),be.height=N,j.cartographicToCartesian(be,ye),Z.push(ye.x),Z.push(ye.y),Z.push(ye.z);var te=pe.BoundingSphere.fromVertices(Z,ae.Cartesian3.ZERO,3,Ve),ie=fe.OrientedBoundingBox.fromRectangle(ue,G,J,j,Ne),e=new ce.EllipsoidalOccluder(j).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(te.center,Z,3,te.center,G,ze),ne=J-G,se=new Uint16Array(o.length+a.length+d.length);for(M=0;M<o.length;++M)se[M]=o[M];var re=o.length;for(M=0;M<a.length;++M)se[re+M]=a[M];for(re+=a.length,M=0;M<d.length;++M)se[re+M]=me*(d[M]-G)/ne;var he,ue=le.IndexDatatype.createTypedArray(o.length,l);return x?(he=new Uint8Array(p),t.push(se.buffer,ue.buffer,he.buffer),he=he.buffer):t.push(se.buffer,ue.buffer),{vertices:se.buffer,encodedNormals:he,indices:ue.buffer,minimumHeight:G,maximumHeight:J,westIndices:K,southIndices:L,eastIndices:Y,northIndices:_,boundingSphere:te,orientedBoundingBox:ie,horizonOcclusionPoint:e}})});
